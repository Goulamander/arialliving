"undefined"==typeof myapp&&(myapp={}),myapp.messageHelper={validateEmpty:e=>0!=e.val().replace(/^\s+|\s+$/g,"").length||(e.parents(".mde-editor").addClass("validationError"),setTimeout(function(){e.parents(".mde-editor").removeClass("validationError")},600),!1),clearForm(e){e.val(""),e.nextAll(".CodeMirror")[0].CodeMirror.getDoc().setValue("")}},"undefined"==typeof myapp&&(myapp={}),myapp.autocomplete={init:(e=$(document))=>{let t=myapp.autocomplete;return e.find('[data-autocomplete="1"]').each(function(){t.initAutocomplete($(this))}),t},initAutocomplete:e=>{myapp.autocomplete;e.typeahead("destroy");const t=e.attr("data-source")||"",n=e.attr("data-return");if(!t||!n)return;if(!["resident","user","building","item"].includes(t))return void console.log(`Autocomplete: Data source [${t}] not allowed for field: ${e.attr("name")}.`);let a=`/sources/${t}s/%QUERY`,i=`/sources/${t}s`,o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:i,remote:{url:a,wildcard:"%QUERY"}});o.initialize(),o.clearPrefetchCache(),$(e).typeahead({hint:!0,highlight:!0,suggestion:!0,minLength:1},{source:o.ttAdapter(),name:"name",displayKey:"name",templates:{notFound:function(e){return""},suggestion:function(e){switch(t){case"user":case"resident":return`<p>${e.first_name} ${e.last_name}<br><small>${e.email}</small></p>`;case"building":return`<p>${e.name}<br><small>${App.helpers.formatAddress(e)}</small></p>`;case"item":return console.log(e),`<p>${e.name}<br><small>${App.helpers.formatAddress(e)}</small></p>`;default:return`<p>${e.name}<br><small>${e.name}</small></p>`}}}}).on("typeahead:selected typeahead:autocomplete",function(e,a){$(this).after(`<input type="hidden" name="${t}_${n}" value="${a[n]}" required>`),$(this).parent(".twitter-typeahead").addClass("selected")}).on("typeahead:selected typeahead:change",function(e,t){}).blur(function(){}),e.keydown(function(e){if(13==e.which){const e=$.Event("keydown");return e.keyCode=39,$(this).trigger(e),e.preventDefault(),!1}$(this).next(`input[name="${t}_${n}"]`).remove(),$(this).parent(".twitter-typeahead").removeClass("selected"),$(this).next(".parsley-errors-list").remove()})}},myapp.autocomplete.init(),"undefined"==typeof myapp&&(myapp={}),myapp.booking={init:function(){const e=myapp.booking;window.addEventListener("load",t=>{const n=sessionStorage.getItem("openBooking")?sessionStorage.getItem("openBooking"):"";n&&(sessionStorage.removeItem("openBooking"),e.openForResident(n,!0))}),$(document).on("click","[data-open-booking]",function(){const t=this.dataset.openBooking;t&&e.openForResident(t)}),$(document).on("click","[data-cancel-booking]",function(){const t=this.dataset.cancelBooking;t&&e.cancelBooking(t)}),$(document).on("change",'input[name="attendees_num"]',function(){const e=this.value||1,t=$(this).parents("form"),n=t[0].querySelector('[name="admin_fee"]');if(totalUi=t[0].querySelector("._total"),!n)return;const a=parseInt(e)*parseInt(n.value);totalUi.innerHTML="$"+NumberFormat(a)}),$("#addCard").on("show.bs.collapse",function(){e.fixSliderHight()}),$("#addCard").on("hide.bs.collapse",function(){e.fixSliderHight()})},open:function(e,t=!1,n=!1){let a;return!1===t&&(a=document.getElementById("mod-booking"),cleanModal(a),$(a).modal("show")),axios.get(`/admin/booking/${e}/get`).then(function(i){if(!i.data.data)return!1;if(!1===t)myapp.templates.booking.renderBooking(a,i.data.data,n);else{let a=myapp.templates.booking.renderBooking(!1,i.data.data,n);if(a=$.parseHTML(a),e==window.open_booking_id)return;window.booking_tippy&&0==window.booking_tippy.state.isDestroyed&&window.booking_tippy.destroy(),window.booking_tippy=tippy(t,{content:$(a)[1],allowHTML:!0,interactive:!0,appendTo:()=>document.body,delay:[0,500],trigger:"click",theme:"light",animation:"shift-toward-subtle",showOnCreate:!0,hideOnClick:"toggle",maxWidth:"none",placement:"auto",zIndex:9999,onHidden(e){e.destroy(),delete window.open_booking_id},onShow(t){this.content.querySelector("._close").addEventListener("click",function(){t.hide()}),document.addEventListener("keyup",function(e){"Escape"===e.key&&!1===t.state.isDestroyed&&t.hide()}),hideAllTippy({exclude:t}),window.open_booking_id=e}})}return myapp.booking.bookingManagerOpened(i.data.data),!1}).catch(e=>_errorResponse(e)),!1},openForResident:function(e,t=!1){const n=document.getElementById("mod-booking");return cleanModal(n),$(n).modal("show"),axios.get(`/booking/${e}`).then(function(e){return!!e.data.data&&(myapp.templates.booking.renderResidentBooking(n,e.data.data,t,!1),myapp.booking.bookingManagerOpened(e.data.data),!1)}).catch(e=>_errorResponse(e)),!1},opened:function(){},bookingManagerOpened:function(e){myapp.booking.initBookingCalendar({item_url:`/items/${e.type_label_url}/${e.bookable_item_id}`,start:e._calendar_start,end:e._calendar_end,exclude_booking_id:e.id,defaultDate:e._calendar_default_date,mode:e._calendar_mode});const t=document.querySelector(".manage__booking").querySelectorAll("[data-tippy-content]");tippy(t,{appendTo:"parent",hideOnClick:!0,trigger:"mouseenter",theme:"translucent",animation:"shift-toward-subtle"})},initBookingCalendar:function(e){const t=document.getElementById("updateBooking"),n=t.querySelector('input[name="date_start"]'),a=t.querySelector('input[name="date_end"]'),i=t.querySelector('select[name="time_start"]'),o=t.querySelector('select[name="time_end"]'),r=document.getElementById("booking_date"),l=document.getElementById("booking_length"),s=t.querySelector('input[name="booking_length"]'),d=t.querySelector('input[name="booking_length_unit"]'),c=t.querySelector(".payment_date");window.ResidentBooking=flatpickr("#bookingCalendar",{altFormat:"M j, Y",dateFormat:"Y-m-d",altInputClass:"edit-booking",defaultDate:e.defaultDate,mode:e.mode,minDate:"today",shorthandCurrentMonth:!0,static:!0,position:"right",locale:{firstDayOfWeek:1},onReady:function(t,l,s){let d=moment(t[0]),c=d;void 0!==t[1]&&(c=moment(t[1]));const m=d.format("YYYY-MM-DD"),p=c.format("YYYY-MM-DD");n.value=m,a.value=p,r&&i&&o&&myapp.booking.validateDate({item_path:e.item_url,start:m,end:p,time_start_el:i,exclude_booking_id:e.exclude_booking_id})},onChange:function(t,l,s){let d=moment(t[0]),c=d;void 0!==t[1]&&(c=moment(t[1]));const m=d.format("YYYY-MM-DD"),p=c.format("YYYY-MM-DD");n.value=m,a.value=p,r&&(i&&o&&myapp.booking.validateDate({item_path:e.item_url,start:m,end:p,time_start_el:i,exclude_booking_id:e.exclude_booking_id}),r.innerHTML=myapp.ResidentBooking._formatDate(d,c))},onMonthChange:function(t,n,a){const i=a.currentMonth+1+"/1/"+a.currentYear,o=moment(i,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(i,"l").add(6,"weeks").format("YYYY-MM-DD"),myapp.ResidentBooking.setCalendar(o,end,e.item_url,e.exclude_booking_id)},onYearChange:function(t,n,a){const i=a.currentMonth+1+"/1/"+a.currentYear,o=moment(i,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(i,"l").add(6,"weeks").format("YYYY-MM-DD"),myapp.ResidentBooking.setCalendar(o,end,e.item_url,e.exclude_booking_id)}}),myapp.ResidentBooking.setCalendar(e.start,e.end,e.item_url,e.exclude_booking_id),myapp.booking.timeStartOnChange(i,o),myapp.booking.timeEndOnChange({date_start:n,date_end:a,time_start:i,time_end:o,ui_length:l,in_length:s,in_length_unit:d,ui_payment_date:c,item_url:e.item_url,calculate_price:!0})},validateDate(e){axios.post(e.item_path+"/validate-date",{start:e.start,end:e.end,exclude_booking_id:e.exclude_booking_id||""}).then(function(t){if(!t.data.data)return!1;const n=t.data.data;let a="";if(n[e.start]&&n[e.start].time_dropdown_options&&(a=n[e.start].time_dropdown_options.map(function(e){return`<option value="${e.value}" data-min="${e.min}" data-max="${e.max}">${moment(e.value,"HH:mm:ss").format("hh:mm a")}</option>`}).join("")),a){let t=$(e.time_start_el),n=t.find("option[data-selected]")?t.find("option[data-selected]").attr("value"):"";t.html(a),n&&t.find(`option[value="${n}"]`).length&&t.val(n),t.trigger("change")}}).catch(e=>_errorResponse(e))},timeStartOnChange(e,t){$(e).change(function(){let e=this.options[this.selectedIndex].dataset.min,n=this.options[this.selectedIndex].dataset.max;if(!e||!n)return;e=moment(e,"HH:mm:ss"),n=moment(n,"HH:mm:ss");let a=`<option value="${e.format("HH:mm:ss")}">${e.format("hh:mm a")}</option>`;if(e.format("HH:mm:ss")!=n.format("HH:mm:ss"))for($i=0;$i<=94&&(a+=`<option value="${(e=e.add(15,"m")).format("HH:mm:ss")}">${e.format("hh:mm a")}</option>`,!(e>=n));$i++);let i=$(t),o=i.find("option[data-selected]")?i.find("option[data-selected]").attr("value"):"";i.html(a),o&&i.find(`option[value="${o}"]`).length&&i.val(o),i.trigger("change")})},timeEndOnChange(e){$(e.time_end).change(function(){try{const t=moment(e.date_start.value+" "+e.time_start.value,"YYYY-MM-DD HH:mm:ss"),n=moment(e.date_end.value+" "+this.value,"YYYY-MM-DD HH:mm:ss");duration=moment.duration(n.diff(t));let a=duration.asHours(),i="",o="";if(a>=24?(a=(a/=24)<=.5?.5:round(a,.5),o="day",i=1==a?a+" day":a+" days"):(i=duration.get("minutes")>0?Math.floor(duration.get("hours"))+":"+duration.get("minutes")+"min":a<=1?a+" hr":a+" hrs",o="hour"),e.ui_length.innerHTML=i,e.in_length.value=a,e.in_length_unit.value=o,1==e.calculate_price&&myapp.booking.updatePricing(1,a,o),!e.ui_payment_date)return;axios.post(e.item_url+"/get-cancellation-cut-off",{booking_start:t}).then(function(t){if(!t.data.data)return!1;e.ui_payment_date.innerHTML=moment(t.data.data.cut_off_date).format("MMMM DD, YYYY")}).catch(e=>_errorResponse(e))}catch(e){return void console.log(e)}})},updatePricing(e,t,n){const a=document.getElementById("bookingSum");if(!a)return;const i=a.querySelector("._subtotal"),o=a.querySelector("._total"),r=a.querySelector('input[name="_price"]'),l=a.querySelector('input[name="_price_unit"]'),s=(a.querySelector('input[name="_subtotal"]'),a.querySelector('input[name="_bond"]')),d=l.value;let c=t;if(n!=d)switch(d){case"day":"hour"==n&&(c=(c=t/24)<=.5?.5:round(c,.5));break;case"hour":"day"==n&&(c=24*t)}const m=e*Number(r.value)*c,p=s.value?m+Number(s.value):m;i.innerHTML="$"+NumberFormat(m),o.innerHTML="$"+NumberFormat(p)},fixSliderHight(){window.slider&&(slider.find(".slick-slide:not(.slick-active)").height("0"),slider.find(".slick-slide.slick-active").height("0"),slider.find(".slick-slide.slick-active").height("auto"),slider.find(".slick-list").height("auto"),slider.slick("setOption",null,null,!0))},afterBookingSubmission(e){e&&e.id&&(sessionStorage.setItem("openBooking",e.id),window.location.href="/")},cancelBooking(e,t=null){e&&axios.post(`/booking/${e}/cancel`,{}).then(function(e){if(!e.data.data)return!1;sessionStorage.setItem("success",e.data.message),window.location.reload()}).catch(e=>_errorResponse(e))}},myapp.booking.init(),"undefined"==typeof myapp&&(myapp={});let CalendarFilters={category:["all"],building:["all"],item:["all"]};function nameInitials(e,t=null,n=!1,a=!1){if(!e)return"...";let i=e.split(" "),o="";for(var r=0,l=i.length;r<l&&2!=r;r++)o+=i[r][0];return n?`<img class="profile-thumb" src="/storage/a/users/${t}.jpg" alt="${e}" ${a?`data-tippy-content="${e}"`:""}/>`:`<span class="initials" ${a?`data-tippy-content="${e}"`:""}>${o.toUpperCase()}</span>`}function convertToID(e,t){return t+"-"+__pad(e,4)}function __pad(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function NumberFormat(e){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function StrToNumber(e){return e=e.toString(),parseFloat(e.replace(/[^0-9-.]/g,""))}function CalculatePercentage(e,t){return e/100*t}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}myapp.calendar={init:function(){const e=myapp.calendar;$(".modal").on("shown.bs.modal",function(){hideAllTippy()}),e.registerEvents();let t=getCookie("CalendarSettings")?JSON.parse(atob(getCookie("CalendarSettings"))):"";CalendarFilters=t||CalendarFilters;let n=e.createSourceURL();document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("calendar");if($(document).on("click","#add_booking",t=>{e.addManualBooking({dateStr:moment().format("YYYY-MM-DD"),dayEl:$("#add_booking")[0]})}),!t)return;const a=document.documentElement.clientHeight-140;window.AdminCalendar=new Calendar(t,{dayMaxEventRows:!0,plugins:[dayGridPlugin,timeGridPlugin,listPlugin,interactionPlugin,momentPlugin],headerToolbar:{left:"title",center:"",right:"dayGridMonth,timeGridWeek,listWeek prev,next"},views:{week:{},timeGrid:{dayMaxEventRows:6}},firstDay:1,selectable:!0,editable:!1,droppable:!1,expandRows:!0,handleWindowResize:!0,fixedWeekCount:!1,contentHeight:a,nowIndicator:!0,displayEventEnd:!0,eventTimeFormat:{hour12:!0,hour:"numeric",minute:"2-digit",meridiem:"short",omitZeroMinute:!0},events:function(e,t,a){const i=moment(e.startStr).format("YYYY-MM-DD"),o=moment(e.endStr).format("YYYY-MM-DD");axios.get(n,{params:{start:i,end:o}}).then(function(e){if(!e.data.events)return!1;e.data.events.building&&AdminCalendar.setOption("businessHours",[{daysOfWeek:[1],startTime:"08:00",endTime:"18:00"},{daysOfWeek:[2,3,4,5],startTime:"10:00",endTime:"16:00"}]),t(e.data.events.events)}).catch(function(e){a(console.log(e))})},eventClick:function(e){myapp.booking.open(e.event.id,e.el)},eventDidMount:function(e){let t=$(e.el).find(".fc-event-title");t&&t.length>0&&$(t[0]).html($(t[0]).text())},dateClick:function(t){window.isAdmin&&e.addManualBooking(t)},viewSkeletonRender:function(){console.log("hello")}}),AdminCalendar.render()})},addManualBooking:e=>{const t=moment(e.dateStr).format("DD MMM, YYYY");let n=0;$(document).on("change","#booking_type",e=>{n=Number($("#booking_type").val()||0)});const a=`\n            <div id="new-calendar-item" class="new-calendar-item">\n                <form method="POST" id="updateBooking" action="/admin/booking/add-manual" data-reload="true">\n                    <button type="button" class="_close"><i class="material-icons">close</i></button>\n                    \x3c!--<strong class="booking_date">${t}</strong>--\x3e\n                    \x3c!--<h3>Add booking to <b>${Laravel.calendar.default_building.name}</b></h3>--\x3e\n                    <h3>Add booking</h3>\n                    <div class="form-group">\n                        <label class="control-label">Select item to make the booking for</label>\n                        <select class="form-control" name="bookable_item_id" id="bookable_item_id" data-s2="1" data-container-id=".tippy-content" data-source="item" data-return="id" data-building-id="all" required>\n                            <option value="">Select</option>\n                        </select>\n                    </div>\n                    <div class="form-group">\n                        <label class="control-label">Select resident or admin</label>\n                        <select class="form-control" name="user_id" id="user_id" data-s2="1" data-container-id=".tippy-content" data-source="user" data-return="id" data-building-id="${Laravel.calendar.default_building.id}">\n                            <option value="">Select</option>\n                        </select>\n                    </div>\n                    <div id="bookingDetailsTab">\n                        <div class="row">\n                            <div class="col">\n                                <small class="d-block">Booking dates</small>\n                                <input type="hidden" class="form-control" id="date_start" name="date_start" value="${e.dateStr}">\n                                <div id="bookingCalendar" class="edit-booking d-flex mt-3 mb-2">\n                                    <strong class="booking_date">${t}</strong>\n                                    <i class="material-icons">keyboard_arrow_down</i>\n                                </div>\n                            </div>\n                            <div class="col">\n                                <small>From</small>\n                                <input type="time" class="form-control" id="time_start" name="time_start" required>\n                            </div>\n                            <div class="col">\n                                <small>To</small>\n                                <input type="time" class="form-control" id="time_end" name="time_end" required>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-group mt-4">\n                        <div class="checkbox text-left mb-0">\n                            <input type="checkbox" id="cleaning_required" name="cleaning_required" class="" value="1" data-parsley-multiple="cleaning_required" checked>\n                            <label for="cleaning_required">Cleaning required</label>\n                        </div>\n                    </div>\n                    <button type="submit" class="btn btn-primary btn-sm btn-round btn-arrow float-right">Next <i class="material-icons">arrow_forward</i></button>\n                </form>\n            </div>`;window.booking_tippy=tippy(e.dayEl,{content:$(a)[0],allowHTML:!0,interactive:!0,appendTo:()=>document.body,delay:[0,500],trigger:"click",theme:"light",animation:"shift-toward-subtle",showOnCreate:!0,hideOnClick:"toggle",maxWidth:"none",placement:"auto",zIndex:9999,onHidden(e){e.destroy()},onShow(e){myapp.select2.init($(e.popper)),this.content.querySelector("._close").addEventListener("click",function(){e.hide()}),document.addEventListener("keyup",function(t){"Escape"===t.key&&!1===e.state.isDestroyed&&e.hide()}),hideAllTippy({exclude:e})}}),window.ResidentBooking=flatpickr("#bookingCalendar",{altFormat:"M j, Y",dateFormat:"Y-m-d",altInputClass:"edit-booking",defaultDate:e.dateStr,minDate:"today",shorthandCurrentMonth:!0,static:!0,position:"right",locale:{firstDayOfWeek:1},onChange:function(e,t,n){let a=moment(e[0]),i=a;void 0!==e[1]&&(i=moment(e[1]));const o=a.format("YYYY-MM-DD");$("#date_start").val(o),$(".booking_date").html(myapp.ResidentBooking._formatDate(a,i))},onMonthChange:function(e,t,n){const a=n.currentMonth+1+"/1/"+n.currentYear,i=moment(a,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(a,"l").add(6,"weeks").format("YYYY-MM-DD"),myapp.ResidentBooking.setCalendar(i,end,calendarOpts.item_url,calendarOpts.exclude_booking_id)},onYearChange:function(e,t,n){const a=n.currentMonth+1+"/1/"+n.currentYear,i=moment(a,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(a,"l").add(6,"weeks").format("YYYY-MM-DD"),myapp.ResidentBooking.setCalendar(i,end,calendarOpts.item_url,calendarOpts.exclude_booking_id)}})},registerEvents:()=>{const e=$("#calendar_filters"),t=e.find('[name="building_filter"]'),n=e.find('[name="category_filter"]'),a=e.find('[name="item_filter"]');let i=getCookie("CalendarSettings")?JSON.parse(atob(getCookie("CalendarSettings"))):"";function o(){let e=t.val()||"all",i=n.val()||"all",o=a.val()||"all";CalendarFilters.category=[i],CalendarFilters.building=[e],CalendarFilters.item=[o],setCookie("CalendarSettings",btoa(JSON.stringify(CalendarFilters)),1),myapp.calendar.CalendarRefetch()}i&&(i.category&&n.find("option").each(function(){i.category.includes(this.value)&&(this.selected="selected")}),i.building&&t.find("option").each(function(){i.building.includes(this.value)&&(this.selected="selected")}),i.item&&a.find("option").each(function(){i.item.includes(this.value)&&(this.selected="selected")})),t.on("change",function(){o(),function(e){let t=e.value,n=e.options[e.selectedIndex].innerHTML;Laravel.calendar.default_building.id=t,Laravel.calendar.default_building.name=n}(this),function(e,t){axios.get("/sources/items",{params:{building_id:"all"==e.value?"":e.value}}).then(function(e){if(!e.data)return;let n=e.data.map(function(e){let t='<option value="all">All items</option>';return e.children.length&&(t+=`<optgroup label="${e.text}">`,t+=e.children.map(function(e){return`<option value="${e.id}">${e.title}</option>`}).join(""),t+="</optgroup>"),t}).join("");n?t.empty().append(n):t.empty().append('<option value="all">All items</option>')}).catch(e=>_errorResponse(e))}(this,a)}),n.on("change",function(){o()}),a.on("change",function(){o()}),$(document).on("click",".fc-button-group > button",function(e){hideAllTippy({duration:0})})},_encodeQueryData:function(e){const t=[];for(let n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},createSourceURL:function(){let e="";return CalendarFilters&&(e=this._encodeQueryData(CalendarFilters)),"/sources/calendar?"+(e=e?e+"&isLocal":"")},CalendarUpdate:()=>{const e=myapp.calendar.createSourceURL();Calendar.fullCalendar("refetchEvents",e)},CalendarRefetch:()=>{const e=myapp.calendar.createSourceURL();AdminCalendar.getEventSources().forEach(e=>{e.remove()}),AdminCalendar.addEventSource(function(t,n,a){const i=moment(t.startStr).format("YYYY-MM-DD"),o=moment(t.endStr).format("YYYY-MM-DD");axios.get(e,{params:{start:i,end:o}}).then(function(e){if(!e.data.events)return!1;n(e.data.events.events)}).catch(function(e){a(console.log(e))})})}},myapp.calendar.init(),"undefined"==typeof myapp&&(myapp={}),myapp.cart={init(){let e=myapp.cart;$(function(){$('.line-items button[name="add_to_cart"]').on("click",function(){const t=parseInt(this.value),n=parseInt($(this).parents("._item").find('[name="add_to_cart_qty"]').val()||0);0!=n&&(e.sync_changes({id:t,action:"add",data:{qty:n}}),this.innerHTML='<i class="icon-like"></i> Added',this.classList.add("_highlight"),setTimeout(()=>{this.innerHTML="Add",this.classList.remove("_highlight")},700))}),$(document).on("click",".cart-items ._remove",function(){const t=$(this).parents("._item"),n=t.data("id");t.remove(),e.sync_changes({id:n,action:"remove"}),myapp.booking.fixSliderHight();const a=document.querySelector('[name="continue_order"]'),i=document.querySelector(".cart-sum");console.log(document.querySelector(".cart-items > ._item")),document.querySelector(".cart-items > ._item")||(injectElement(document.querySelector(".cart-items"),'<div class="cart_empty_sate">\n                        <h4>Add items to your cart</h4>\n                    </div>'),a.disabled=!0,i.classList.add("hidden"),i.classList.remove("add_in")),e.update_totals()}),$(document).on("click",".cart-items ._add",function(t){const n=$(this).parents("._item"),a=$(this).prev(".cart_qty"),i=parseInt(a.val()),o=n.data("id");a.val(i+1),e.sync_changes({id:o,action:"update",data:{qty:i+1}}),e.update_totals()}),$(document).on("click",".cart-items ._minus",function(t){const n=$(this).parents("._item"),a=$(this).next(".cart_qty"),i=parseInt(a.val()),o=n.data("id");i<=1||(a.val(i-1),e.sync_changes({id:o,action:"update",data:{qty:i-1}}),e.update_totals())}),$('button[name="continue_order"]').on("click",function(){this.dataset.summary&&e.updateOrderSummary(),0==$(this).parents(".slick-slide").data("slick-index")&&e.setAddCartButtons("disable"),window.slider.slick("slickGoTo",this.dataset.page)})})},sync_changes(e){axios.post(window.location.href+"/sync-cart",{item_id:e.id,action:e.action,qty:e.data?e.data.qty:""}).then(function(t){if(!t.data.data)return!1;if(t.data.data.line_item){const n=t.data.data.line_item;myapp.cart.add_item_UI(n,e.data.qty)}}).catch(e=>_errorResponse(e))},update_totals(){const e=$(".cart_subtotal"),t=$(".cart_admin_fee"),n=$(".cart_admin_bond"),a=$(".cart_total"),i=$(".cart-items > ._item");let o=0,r=0;if(i.each(function(){let e=parseFloat(this.dataset.price),t=parseInt($(this).find(".cart_qty").val());r+=e*t}),t.length){const e=parseFloat(t[0].dataset.price);o+=r+e}else if(n.length){const e=parseFloat(n[0].dataset.price);o+=r+e}else o=r;e.attr("data-price",r),e.html("$"+NumberFormat(r)),a.attr("data-price",o),a.html("$"+NumberFormat(o))},add_item_UI(e,t){const n=$('.cart-items > [data-id="'+e.id+'"]');if(n.length){const e=$(n).find(".cart_qty");return e.val(parseInt(e.val())+t),void myapp.cart.update_totals()}const a=`\n            <div data-id="${e.id}" data-price="${e.price||0}" class="_item">\n                ${e.is_thumb?`\n                <img class="thumb" width="50" height="50" src="/storage/items/${e.item_id}/line-items/${e.id}.jpg" alt="${e.name}"/>\n                `:""}\n                <div class="item_body">\n                    <span class="item_name">${e.name}</span>\n                    <span class="item_price">${e.price&&parseFloat(e.price)>0?"$"+NumberFormat(e.price):"Free"}</span>\n                </div>\n                <div class="item_controls">\n                    <button type="button" class="_minus btn btn-sm">-</button>\n                    <input type="number" class="cart_qty" value="${t}" min="1" max="100"/>\n                    <button type="button" class="_add btn btn-sm">+</button>\n                    <button type="button" class="_remove no-btn"><i class="icon-close"></i></button>\n                </div>\n            </div>`;injectElement(document.querySelector(".cart-items"),a),myapp.booking.fixSliderHight();const i=document.querySelector(".cart_empty_sate"),o=document.querySelector('[name="continue_order"]'),r=document.querySelector(".cart-sum");i&&(removeElement(i),o.disabled=!1,r.classList.remove("hidden"),r.classList.add("add_in")),myapp.cart.update_totals()},updateOrderSummary(){const e=document.getElementById("BookingForm"),t=e.querySelectorAll(".cart-items > ._item"),n=e.querySelector(".cart_subtotal").innerHTML,a=e.querySelector(".cart_admin_fee")?e.querySelector(".cart_admin_fee").innerHTML:"",i=e.querySelector(".cart_total").getAttribute("data-price"),o=e.querySelector(".cart_total").innerHTML;let r=e.querySelector('input[name="date_start"]');const l=[];t.forEach(e=>{let t={name:e.querySelector(".item_name").innerHTML,price:e.querySelector(".item_price").innerHTML,qty:e.querySelector(".cart_qty").value};l.push(t)});const s=e.querySelector(".booking-summary ._date"),d=document.getElementById("booking_service_costing");let c=l.map(e=>`<li><strong class="_qty">${e.qty}</strong> x <b>${e.name}</b> <span>${e.price}</span></li>`).join("");c+=`\n        <li>Subtotal (inc. GST) <span class="_subtotal">${n}</span></li>\n            ${a?`<li>Admin fee <span>${a}</span></li>`:""}`,r&&(r=moment(r.value,"YYYY-MM-DD").format("MMMM DD, YYYY"),s.innerHTML=r),d.querySelector("ul.line-items").innerHTML=c,d.querySelector("._total").innerHTML=o;const m=$("#credit-card ").find("input, select");Number(i)>0?($("#credit-card").show(),m.each((e,t)=>{$(t).attr("required",!0)})):($("#credit-card").hide(),m.each((e,t)=>{$(t).removeAttr("required")}))},setAddCartButtons(e){const t=document.getElementById("cart_line_items");if(!t)return;let n=t.querySelectorAll(".add_to_cart");n&&n.forEach(t=>{let n=t.querySelector("button");"disable"==e?(n.disabled=!0,n.innerHTML='<i class="icon-lock"></i> Add'):(n.disabled=!1,n.innerHTML="Add")})}},myapp.cart.init(),"undefined"==typeof myapp&&(myapp={}),myapp.category={init:function(){this.registerEvents()},registerEvents:function(){let e=this;$(document).on("click","[data-open-category]",function(){e.open($(this).attr("data-open-category"))})},open:function(e){if(!e)return;let t=$("#mod-category");axios.get(`/admin/settings/category/get/${e}`).then(function(e){if(!e.data)return!1;myapp.modal.fillThenOpen(t,e.data.data)}).catch(e=>_errorResponse(e))}},myapp.category.init(),"undefined"==typeof myapp&&(myapp={}),myapp.comment={init:function(){let e=myapp.comment;$(function(){$(document).on("click",'.comment-list button[name="add"]',function(t){const n=this,a=$(this).parents(".new");if(0==myapp.messageHelper.validateEmpty(a.find("textarea")))return;n.classList.add("loading"),n.disabled=!0;let i=myapp.form.collectInputs(a);return i.id=0,i.type=1,i.parent_comment_id&&(i.type=2),e.save(i).then(function(e){const t=myapp.templates.comment.render([e]),i=$(".comment-list > .today");1==i.length?i.replaceWith(t):$(".comment-list > .new").after(t),myapp.messageHelper.clearForm(a.find("textarea")),n.classList.remove("loading"),n.disabled=!1}).catch(e=>_errorResponse(e)),t.preventDefault(),!1}),$(document).on("click",'.comment button[name="edit"]',function(){const e=$(this).parents(".comment"),t=this.value;axios.get(`/admin/comments/get/${t}`).then(function(n){if(!n.data)return!1;const a=2==n.data.type;content=a?myapp.templates.comment.renderReplyEditor(n.data.id,0):myapp.templates.comment.renderEditor(n.data),content=$.parseHTML(content);const i=$(content).find("textarea"),o=myapp.markup.initSimpleMDE(i[0],a).codemirror;o.getDoc().setValue(n.data.comment);let r=tippy(`.comment-list [data-id="${t}"]`,{content:$(content)[0],allowHTML:!0,interactive:!0,appendTo:"parent",delay:[0,500],trigger:"click",theme:"light",animation:"shift-toward-subtle",showOnCreate:!0,hideOnClick:"toggle",maxWidth:"450",zIndex:9,onHidden(t){t.destroy(),e.removeClass("active")},onShow(t){hideAllTippy({duration:.5}),e.addClass("active")}});setTimeout(()=>{o.focus(),o.setCursor(o.lineCount(),0)},50),$(content).find('button[name="edit"]').on("click",function(e){myapp.comment.updateComment(this,r)})}).catch(e=>_errorResponse(e))}),$(document).on("click",'.comment button[name="reply"]',function(){const e=$(this).parents(".comment"),t=e.data("id");let n=myapp.templates.comment.renderReplyEditor(0,t);n=$.parseHTML(n);const a=$(n).find("textarea"),i=myapp.markup.initSimpleMDE(a[0],!0).codemirror;let o=tippy(`[data-id="${t}"].comment`,{content:$(n)[0],allowHTML:!0,interactive:!0,appendTo:"parent",delay:[0,500],trigger:"click",theme:"light",animation:"shift-toward-subtle",showOnCreate:!0,hideOnClick:"toggle",maxWidth:"450",zIndex:9,onHidden(t){t.destroy(),e.removeClass("active")},onShow(t){hideAllTippy({duration:.5}),e.addClass("active")}});setTimeout(()=>{i.focus(),i.setCursor(1,1)},50),$(n).find('button[name="edit"]').on("click",function(e){myapp.comment.updateComment(this,o)})}),$(document).on("click",'.comment button[name="delete"]',function(){const t=$(this).closest("[data-id]");comment_id=this.value,e.delete(t,comment_id||0)})})},save:async function(e,t=!1){if(!e)return!1;let n=window.location.pathname.split("/");n=removeArrayItem(n,""),n=removeArrayItem(n,"admin"),e.data_type=n[0],e.data_id=n[1];try{return(await axios.post("/admin/comments/store",e)).data}catch(e){console.log(e)}return!1},delete:(e,t)=>!!t&&(axios.post("/admin/comments/delete",{comment_id:t}).then(function(t){return e.prev(".comment-feed-date").length&&!e.next(".comment").length&&removeElement(e.prev(".comment-feed-date")[0]),removeElement(e[0]),!0}).catch(e=>_errorResponse(e)),!1),updateComment:function(e,t){const n=e,a=$(e).parents(".edit");if(0==myapp.messageHelper.validateEmpty(a.find("textarea")))return;n.classList.add("loading"),n.disabled=!0;let i=myapp.form.collectInputs(a);return i.type=1,i.parent_comment_id&&(i.type=2),myapp.comment.save(i).then(function(e){if(!e)return!1;let o=2==e.type?myapp.templates.comment.reply([e]):myapp.templates.comment.render([e],!1);i.id>0?$(`.comment-list [data-id="${i.id}"]`).replaceWith(o):$(`.comment-list [data-id="${i.parent_comment_id}"] > .comment--body`).after(o),t[0].hide(),n.classList.remove("loading"),n.disabled=!1,a.removeClass("active")}).catch(e=>_errorResponse(e)),!1},loadMoreCommentsInit:e=>{if(!document.getElementById("admin-comments"))return;const t=document.getElementById("admin-comments"),n=t.querySelectorAll(".comment-list")[0],a=new IntersectionObserver((t,a)=>{!0===t[0].isIntersecting&&myapp.comment.loadMoreComments(n,e)});t.querySelector(".comment-list .comment:last-child")&&a.observe(t.querySelector(".comment-list .comment:last-child"))},loadMoreComments(e,t){console.log("todo: get data_type and data_id"),axios.get(`/${window.history.state.data_type}/api/get/${window.history.state.data_id}/comments`,{params:{offset:t.offset,limit:t.limit}}).then(function(n){if(!n.data||0==n.data.length)return!1;let a=myapp.templates.comment.render(n.data);return e.insertAdjacentHTML("beforeend",a),myapp.comment.loadMoreCommentsInit({offset:t.offset+t.limit,limit:t.limit}),myapp.tippy.init(document.getElementById("admin-comments")),!1}).catch(e=>_errorResponse(e))}},myapp.comment.init(),"undefined"==typeof myapp&&(myapp={}),myapp.dateTimePickers={init:()=>{flatpickr(".datePickr",{altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",positionElement:".modal",static:!0,onChange:function(e,t,n){switch(n.element.name){case"repeat_start":return $('input[name="frequency_week_days"].primary').prop("checked",!1).removeClass("primary"),$(`#_week_days_${moment(t).day()}`).prop("checked",!0).addClass("primary"),void $('input[name="repeat_end"]')[0].flatpickr().set("minDate",t);default:return}}}),flatpickr(".datetimePickr",{enableTime:!0,altInput:!0,altFormat:"M j, Y h:i K",dateFormat:"Y-m-d H:i:ss"}),flatpickr(".timePickr",{noCalendar:!0,enableTime:!0,altInput:!0,altFormat:"h:i K",dateFormat:"H:i:ss",positionElement:".modal",static:!0}),flatpickr(".time24Pickr",{noCalendar:!0,enableTime:!0,dateFormat:"H:i",positionElement:".modal",static:!0,time_24hr:!0}),flatpickr(".dateRangePickr",{altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",mode:"range",allowInput:!1})}},myapp.dateTimePickers.init(),"undefined"==typeof myapp&&(myapp={}),myapp.fileManager={init(){let e=myapp.fileManager;e.initThumbUploader(),e.initPDFUploader(),e.initGalleryUploader(),e.initInlineUploader()},initInlineUploader(e=null){if(e||(e=document.querySelectorAll(".inline-uploader")),!e)return!1;e.forEach(function(e){FilePond.create(e,{labelIdle:'<span class="filepond--label-action"> Browse </span>',acceptedFileTypes:["image/png","image/jpeg","image/jpg","image/gif"],allowFileEncode:!0,allowImagePreview:!0,imagePreviewHeight:240,imagePreviewMaxHeight:400,maxFileSize:"2MB"})})},initThumbUploader(e=".image-thumb-uploader"){const t=document.querySelector(e);if(!t)return!1;let n=t.dataset.path||"";t.dataset.filename;FilePond.create(t,{server:{url:"/api/filepond",revert:"/delete",process:{url:"/process",method:"POST",ondata:e=>(e.append("folder",n),e.append("process_type",t.dataset.processType||""),e),onload:e=>{e=JSON.parse(e),console.log(e),t.dataset.filename=e.data.file_name},onerror:e=>{_errorResponse(JSON.parse(e))}},load:"/load/",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}},labelIdle:'<span class="filepond--label-action"> Browse </span>',acceptedFileTypes:["image/png","image/jpeg","image/jpg","image/gif"],allowImagePreview:!0,imagePreviewHeight:50,stylePanelLayout:"compact circle",styleLoadIndicatorPosition:"center bottom",styleProgressIndicatorPosition:"right bottom",styleButtonRemoveItemPosition:"center bottom",styleButtonProcessItemPosition:"right bottom"}).on("removefile",(e,a)=>{if(!e){let e=n+t.dataset.filename.trim();axios.post("/api/filepond/delete",{path:e,folder:n}).then(function(e){if(!e.data)return!1;sc.alert.show("alert-success",e.data.message||"Successful update")}).catch(e=>_errorResponse(e))}})},initGalleryUploader(e='input[type="file"]._gallery'){const t=document.querySelector(e);if(!t)return!1;let n=t.dataset.path||"";FilePond.create(t,{server:{url:"/api/filepond",process:{url:"/process",method:"POST",ondata:e=>(e.append("folder",n),e.append("process_type",t.dataset.processType||""),e),onload:e=>{e=JSON.parse(e),myapp.fileManager.attachImageToGallery(e.data.url)},onerror:e=>{_errorResponse(JSON.parse(e))}},revert:"/process",load:"/load/",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}},labelIdle:'<h4>Upload images</h4><br>Drag & Drop or <span class="filepond--label-action"> Browse </span>',acceptedFileTypes:["image/png","image/jpeg","image/jpg","image/gif"],allowFileEncode:!0,allowMultiple:!0,allowImagePreview:!1,allowImageResize:!0,imageResizeTargetWidth:1440,imageResizeMode:"cover",imageResizeUpscale:!1,allowImageValidateSize:!0,imageValidateSizeMinWidth:1440,imageValidateSizeMinHeight:500})},initPDFUploader(e='input[type="file"]._attachments'){const t=document.querySelector(e);if(!t)return!1;let n=t.dataset.path||"";FilePond.create(t,{server:{url:"/api/filepond",process:{url:"/process",method:"POST",ondata:e=>(e.append("folder",n),e.append("process_type",t.dataset.processType||""),e),onload:e=>{e=JSON.parse(e),myapp.fileManager.attachPDFToList(e.data.url)},onerror:e=>{_errorResponse(JSON.parse(e))}},revert:"/process",load:"/load/",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}},labelIdle:`<h4>${t.getAttribute("data-title")||""}</h4><br> Drag & Drop or <span class="filepond--label-action"> Browse </span>`,allowImagePreview:!1,allowFileSizeValidation:!0,maxTotalFileSize:"100MB",acceptedFileTypes:["application/pdf"]})},attachImageToGallery(e){if(!e)return!1;let t=document.querySelector("._image_gallery");if(!t)return;let n=t.querySelector(".empty");n&&n.remove();let a=`\n        <div class="_img" style="background-image: url(/storage/${e})" data-file="${e}">\n            <button type="button" class="no-btn _delete">\n                <i class="material-icons">delete</i>\n            </button>\n        </div>`;t.insertAdjacentHTML("beforeend",a),myapp.singlePage.initGallery()},attachPDFToList(e){if(!e)return!1;let t=document.querySelector("._pdf_list");if(!t)return;let n=t.querySelector(".empty");n&&n.remove();let a=`\n        <div data-file="${e}" class="_pdf">\n            <a href="/storage/${e}" data-iframe="true" class="term-link">${getCleanPDFNameFromPath(e)}</a>\n            <div class="dropdown dropleft _actions">\n                <a class="no-btn" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                    <i class="zmdi zmdi-more"></i>\n                </a>\n                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">\n                    <button type="button" class="dropdown-item _rename">Rename</button>\n                    <button type="button" class="dropdown-item _delete">Delete</button>\n                </div>\n            </div>\n        </div>`;t.insertAdjacentHTML("beforeend",a),myapp.singlePage.initPDFList(),myapp.singlePage.initPDFPreviewer()},updatePDFListAfterUpdate(e){let t=document.querySelector("._pdf_list");if(!t)return;let n=t.querySelector(`[data-file="${e.old_path}"]`),a=n.querySelector(".term-link");n.dataset.file=e.new_path,a.href=`/storage/${e.new_path}`,a.innerHTML=getCleanPDFNameFromPath(e.new_path)}},myapp.fileManager.init(),"undefined"==typeof myapp&&(myapp={}),myapp.form={init:()=>{const e=myapp.form;$(function(){$(".alert[data-auto-dismiss]").length&&$(".alert[data-auto-dismiss]").each(function(e,t){const n=$(t).data("auto-dismiss")||2e3;setTimeout(function(){$(t).fadeOut(500,function(){$(this).alert("close")})},n)}),$(document).on("change","[data-conditions]",function(e){myapp.form.doFieldConditions(this)}),$("[data-conditions]").each(function(e){myapp.form.doFieldConditions(this)}),$(".office-hours-switch").on("change",function(){const e=$(this).parents("li").find(".from"),t=$(this).parents("li").find(".to");1==this.checked?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))});let e=$("#clearing_fee_count").val()||0;$(document).on("click",".add-more-fee .add-more",function(t){t.preventDefault(),$(".add-more-fee .add-more-fee__items").append(`\n                    <div class="row mb-2 add-more-fee__item">\n                        <div class="col">\n                            <input type="text" name="clearing_fee[${e}].name" class="form-control" placeholder="Name">\n                        </div>\n                        <div class="col">\n                            <input type="number" name="clearing_fee[${e}].fee" min="0" class="form-control" placeholder="Fee">\n                        </div>\n                        <div class="col-1">\n\t\t\t\t            <button type="button" class="btn btn-primary p-1 remove"><i class="material-icons">remove</i></button>\n                        </div>\n                    </div>\n                `),e++,$("#clearing_fee_count").val(e)}),$(document).on("click",".add-more-fee .remove",function(t){t.preventDefault(),$(this).closest(".add-more-fee__item").remove(),e--,$("#clearing_fee_count").val(e)})}),e.registerCustomParsleyValidators()},collectInputs:e=>{if(!e)return!1;var t=e.find("input, select, button, textarea, checkbox:checked"),n={};if(t.each(function(){if(this.multiple){var t,a=new Array,i=0;if(this.options)for(t=0;t<this.options.length;t++)this.options[t].selected&&(a[i]=this.options[t].value,i++);n[this.name]=a}else{if("checkbox"==this.type){let t=e.find("[name='"+this.name+"']").length;return n[this.name]||(n[this.name]=t>1?[]:0),void(this.checked&&(t>1?n[this.name].push(this.value||1):n[this.name]=this.value||1))}if("radio"!=this.type){if(this.name.includes("clearing_fee"))return window._.set(n,this.name,this.value),void(n.clearing_fee=n.clearing_fee.filter(e=>!!e&&e&&!!e.name));if(this.name.includes("[]")){let e=this.name.replace("[]","");return n[e]||(n[e]=[]),void n[e].push(this.value)}this.name&&(n[this.name]=this.value)}else this.checked&&(n[this.name]=this.value)}}),e.data("encrypt")&&window.Laravel.config.encrypt_key){const e=$("#card_number"),t=$("#card_cvn");e.length&&(n.card_number=encryptValue(e.val().replace(/ /g,""),window.Laravel.config.encrypt_key),n.card_cvn=encryptValue(t.val(),window.Laravel.config.encrypt_key))}if(window.BookingSignature){const e=$(".signature_box canvas"),t=$(".signature_box label");if(window.BookingSignature.isEmpty())return e.addClass("validation-error"),t.addClass("validation-error"),!1;e.removeClass("validation-error"),t.removeClass("validation-error"),n.signature=window.BookingSignature.toDataURL("image/svg+xml")}return n},doFieldConditions(e){if(!e.dataset.conditions)return;const t=JSON.parse(e.dataset.conditions);if(t)for(var n in t){const a=t[n];let i="";switch(e.type){case"checkbox":case"radio":i=e.checked?e.value:"";break;default:i=e.value}const o=a.fields.split("|");if(!o)return;const r=a.if_value.split(":");if(2==r.length){const e=r[0];let t=r[1];switch(e){case"in":t=t.split(","),o.forEach(e=>t.indexOf.value?$(`._${e}`).removeClass("hidden"):$(`._${e}`).addClass("hidden"));break;case"is":o.forEach(e=>t==i?$(`._${e}`).removeClass("hidden"):$(`._${e}`).addClass("hidden"));break;case"not":o.forEach(e=>t!=i?$(`._${e}`).removeClass("hidden"):$(`._${e}`).addClass("hidden"));break;case"or":t=t.split(","),o.forEach(e=>t.includes(i)?$(`._${e}`).removeClass("hidden"):$(`._${e}`).addClass("hidden"))}}else"null"==r[0]&&o.forEach(e=>""!=i?$(`._${e}`).addClass("hidden"):$(`._${e}`).removeClass("hidden"))}},registerCustomParsleyValidators(){window.Parsley.addValidator("number",{requirementType:"number",validateString:function(e,t){return(e.match(/[0-9]/g)||[]).length>=t},messages:{en:"Your password must contain at least (%s) number."}}),window.Parsley.addValidator("special",{requirementType:"number",validateString:function(e,t){return(e.match(/[^a-zA-Z0-9]/g)||[]).length>=t},messages:{en:"Your password must contain at least (%s) special characters."}})}},myapp.form.init();const capitalize=e=>"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1);function textTruncate(e,t,n){if(e.length<=t)return e;var a=t-(n=n||"...").length,i=Math.ceil(a/2),o=Math.floor(a/2);return e.substr(0,i)+n+e.substr(e.length-o)}function base64url_encode(e){let t=btoa(e);return!1!==t&&t.replace("+/","-_").replace(/=+$/,"")}function round(e,t){t||(t=1);var n=1/t;return Math.round(e*n)/n}function setCookie(e,t,n){const a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=e+"="+t+"; expires="+a.toGMTString()}function getCookie(e){let t=e+"=",n=document.cookie.split(";");for(var a=0;a<n.length;a++){let e=n[a].trim();if(0==e.indexOf(t))return e.substring(t.length,e.length)}return""}function getNodeHeight(e){var t,n=e.cloneNode(!0);return n.style.cssText="position:fixed; top:-9999px; opacity:0;",document.querySelector(".cart-items").appendChild(n),t=n.clientHeight,n.parentNode.removeChild(n),t}function removeArrayItem(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e}String.prototype.slugToStr=function(){return a=this.replace("-"," "),a.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},String.prototype.allTrim=String.prototype.allTrim||function(){return this.replace(/\s+/g," ").replace(/^\s+|\s+$/,"")},injectElement=function(e,t){if(!t)return;let n=$.parseHTML(t.allTrim())[0],a=getNodeHeight(n);n.style.setProperty("--h",a+"px"),n.classList.add("add_in"),e.prepend(n)},removeElement=function(e){e&&(e.classList.add("remove_item"),setTimeout(()=>{e.remove()},700))},cleanModal=function(e){e.querySelector(".modal-body").innerHTML=""},$.fn.clearForm=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();if("form"==t)return $(":input",this).clearForm();e.includes("text","email","number","password","date")||"textarea"==t?this.value="":"checkbox"==e||"radio"==e?this.checked=!1:"select"==t&&(this.selectedIndex=0)})},_errorResponse=function(e){if(console.log(e),void 0!==e.response.status){switch(e.response.status){case 422:$response_body=Object.values(e.response.data.errors).map(function(e){return e}).join(", ");break;case 400:$response_body=e.response.data.error;break;default:let t=`\n                <b>Error:</b> ${e.response.data.message}<br>\n                <b>File:</b> ${e.response.data.file}<br>\n                <b>Line:</b> ${e.response.data.line}<br>`;$response_body=t}sc.alert.show("alert-danger",$response_body,5e3)}};const pSBC=(e,t,n,a)=>{let i,o,r,l,s,d,c,m=parseInt,p=Math.round,u="string"==typeof n;return"number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||n&&!u?null:(this.pSBCr||(this.pSBCr=(e=>{let t=e.length,n={};if(t>9){if([i,o,r,u]=e=e.split(","),(t=e.length)<3||t>4)return null;n.r=m("a"==i[3]?i.slice(5):i.slice(4)),n.g=m(o),n.b=m(r),n.a=u?parseFloat(u):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?e[4]+e[4]:"")),e=m(e.slice(1),16),9==t||5==t?(n.r=e>>24&255,n.g=e>>16&255,n.b=e>>8&255,n.a=p((255&e)/.255)/1e3):(n.r=e>>16,n.g=e>>8&255,n.b=255&e,n.a=-1)}return n})),c=t.length>9,c=u?n.length>9||"c"==n&&!c:c,s=this.pSBCr(t),l=e<0,d=n&&"c"!=n?this.pSBCr(n):l?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},l=1-(e=l?-1*e:e),s&&d?(a?(i=p(l*s.r+e*d.r),o=p(l*s.g+e*d.g),r=p(l*s.b+e*d.b)):(i=p((l*s.r**2+e*d.r**2)**.5),o=p((l*s.g**2+e*d.g**2)**.5),r=p((l*s.b**2+e*d.b**2)**.5)),u=s.a,d=d.a,u=(s=u>=0||d>=0)?u<0?d:d<0?u:u*l+d*e:0,c?"rgb"+(s?"a(":"(")+i+","+o+","+r+(s?","+p(1e3*u)/1e3:"")+")":"#"+(4294967296+16777216*i+65536*o+256*r+(s?p(255*u):0)).toString(16).slice(1,s?void 0:-2)):null)};getCleanPDFNameFromPath=function(e){let t=e.substring(e.lastIndexOf("/")+1);return(t=(t=(t=(t=t.replaceAll("-"," ")).replace(".pdf","")).replace(/^(.*?)___/," ")).toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()})).trim()},"undefined"==typeof myapp&&(myapp={}),myapp.globalSearch={init(e=null){let t=myapp.globalSearch;$("document").ready(function(){$("#global-search").on("keyup",t.delay(function(e){t.getSearchData(this.value)}))})},getSearchData(e){$.ajax({url:`/items-search?search=${e}`,type:"GET",success:function(e){$("#items-content").html(e),myapp.carousel&&myapp.carousel.init()},fail:function(e){_errorResponse(e)}})},delay(e,t=500){var n=0;return function(){var a=this,i=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,i)},t||0)}}},myapp.globalSearch.init(),"undefined"==typeof myapp&&(myapp={}),myapp.htmlEditor={init(){$(function(){const e=document.getElementsByClassName("_html_editor");Array.prototype.forEach.call(e,function(e){e.quill=new Quill(e,{modules:{toolbar:[["bold","italic","underline"],[{header:1},{header:2}],[{list:"bullet"},{list:"ordered"}],["link"],[{align:[]}],["clean"]]},handlers:{link:function(e){if(e){var t=prompt("Enter the URL");this.quill.format("link",t)}else this.quill.format("link",!1)}},theme:"snow"}),e.quill.theme.tooltip.root.querySelector("input[data-link]").dataset.link="Enter URL or use the [link] shortcode"});const t=document.getElementsByClassName("_full_html_editor");Array.prototype.forEach.call(t,e=>{e.quill=new Quill(e,{modules:{toolbar:[[{size:[]}],["bold","italic","underline","strike"],[{color:[]}],[{header:"2"},{header:"3"},"blockquote","code-block"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["direction",{align:[]}],["link","image","video"],["clean"]]},handlers:{link:function(e){if(e){var t=prompt("Enter the URL");this.quill.format("link",t)}else this.quill.format("link",!1)}},theme:"snow"}),e.quill.theme.tooltip.root.querySelector("input[data-link]").dataset.link="Enter URL"})})}},myapp.htmlEditor.init(),"undefined"==typeof myapp&&(myapp={}),myapp.carousel={init:function(){const e=document.querySelectorAll(".item__slider");if(!e.length)return;let t=3;window.innerWidth<=992&&(t=2),window.innerWidth<=767&&(t=1),e.forEach(e=>{let n=e.querySelector(".embla__viewport"),a=e.querySelector(".embla__button--prev"),i=e.querySelector(".embla__button--next"),o=e.querySelector(".embla__dots"),r=EmblaCarousel(n,{dragFree:!1,slidesToScroll:t,align:0,containScroll:!0,loop:!1,startIndex:0}),l=((e,t)=>{const n=t.scrollSnapList(),a=document.createDocumentFragment(),i=n.map(()=>document.createElement("button"));return i.forEach(e=>a.appendChild(e)),e.appendChild(a),i})(o,r),s=((e,t)=>()=>{const n=t.previousScrollSnap(),a=t.selectedScrollSnap();e[n].classList.remove("is-selected"),e[a].classList.add("is-selected")})(l,r),d=((e,t,n)=>()=>{n.canScrollPrev()?e.removeAttribute("disabled"):e.setAttribute("disabled","disabled"),n.canScrollNext()?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")})(a,i,r);((e,t,n)=>{e.addEventListener("click",n.scrollPrev,!1),t.addEventListener("click",n.scrollNext,!1)})(a,i,r),((e,t)=>{e.forEach((e,n)=>{e.classList.add("embla__dot"),e.addEventListener("click",()=>t.scrollTo(n),!1)})})(l,r),r.on("select",s),r.on("select",d),r.on("init",s),r.on("init",d),r.on("resize",()=>{let e=3;window.innerWidth<=992&&(e=2),window.innerWidth<=767&&(e=1),r.changeOptions({slidesToScroll:e})})})},initBookingGallerySlider(){const e=$(".booking-single--slider .__slider");0!=e.length&&e.slick({dots:!0,infinite:!0,speed:500,fade:!0,cssEase:"linear",autoplay:!0,pauseOnFocus:!1,pauseOnHover:!1})}},myapp.carousel.init(),myapp.carousel.initBookingGallerySlider(),"undefined"==typeof myapp&&(myapp={}),myapp.lineItem={init:function(){this.registerEvents()},registerEvents:function(){let e=this;$(document).on("click","[data-open-item]",function(){e.open($(this).attr("data-open-item"))})},open:function(e){if(!e)return;let t=$("#mod-line-item");axios.get(`/admin/item/service-items/get/${e}`).then(function(e){if(!e.data)return!1;myapp.modal.fillThenOpen(t,e.data.data)}).catch(e=>_errorResponse(e))}},myapp.lineItem.init(),"undefined"==typeof myapp&&(myapp={}),myapp.markup={init(e=$("body")){let t=myapp.markup;e.find("textarea.comment").each(function(){t.initSimpleMDE(this)}),$(".convert-to-markdown").find("a").each(function(){$(this).attr("target","_blank")})},initSimpleMDE(e,t=!1){if(!e)return!1;let n=["bold","italic","heading","|","unordered-list","ordered-list","|","code","link","image","preview","|"];return t&&(n=["bold","italic","heading","|","unordered-list","ordered-list","|"]),new SimpleMDE({element:e,forceSync:!0,toolbar:n,tabSize:4,status:!1,autofocus:!1})}},myapp.markup.init(),"undefined"==typeof myapp&&(myapp={}),myapp.modal={init:function(){$(function(){$(document).on("click",".md-trigger",function(){const e=$(this).attr("data-target")||"",t=$(e);action_route=$(this).attr("data-route")||"";let n=this.dataset.fill?this.dataset.fill.split(":"):"";n&&2==n.length&&t.find(`input[name="${n[0]}"]`).val(n[1]),action_route&&t.find("form").prop("action",action_route),t.length&&t.find("input[data-id]").val(this.value)}),$(document).on("click","a.actions",function(e){e.preventDefault();$(this).data("id");let t=$(this).attr("href"),n=$(this).data("target"),a=$(this).data("reload")||!1;$(n).find("form").prop("action",t).attr("data-reload",a),$(n).modal("toggle")})})},fillThenOpen(e,t){if(!e)return;t||e.modal("show");let n=e[0].innerHTML;for(key in e[0].querySelector(".modal-header h3").innerHTML=t.name||t.title,e[0].querySelector("form").action=t.update_route,t){if(!t.hasOwnProperty(key))continue;let n=e[0].querySelector(`[name="${key}"]:not([type="file"])`);n&&(n.value=t[key])}let a=e[0].querySelector(".inline-uploader");a&&t.thumb_path&&(a.insertAdjacentHTML("afterbegin",`<input type="hidden" value="${t.thumb_path}">`),myapp.fileManager.initInlineUploader([a])),e.modal({backdrop:"static",keyboard:!1},"show"),e.on("hidden.bs.modal",function(){e[0].innerHTML=n,myapp.fileManager.initInlineUploader()})}},myapp.modal.init(),"undefined"==typeof myapp&&(myapp={}),myapp.recurringSetting={init(){let e=myapp.recurringSetting;$(function(){$(document).on("change",'select[name="event.type"]',function(){const e=$(this).parents("form"),t=e.find(".single_event"),n=e.find(".recurring_options");2==$(this).val()?(t.removeClass("active"),n.addClass("active")):(t.addClass("active"),n.removeClass("active"))}),$(document).on("change",'input[name="repeat_start"], input[name="repeat_end"]',function(){const t=$(this).parents("form");e.recurring_preview(t)}),$(document).on("change",'input[name="repeat_every"]',function(){const t=$(this).parents("form"),n=$('select[name="frequency"]');this.value>1?n.find("option").each(function(){switch(this.text){case"Week":this.text="Weeks";break;case"Month":this.text="Months";break;case"Year":this.text="Years"}}):n.find("option").each(function(){switch(this.text){case"Weeks":this.text="Week";break;case"Months":this.text="Month";break;case"Years":this.text="Year"}}),e.recurring_preview(t)}),$(document).on("change",'select[name="frequency"]',function(){const t=$(this).parents("form"),n=t.find(".freq_7");switch($(this).val()){case"7":n.addClass("active");break;case"30":case"365":n.removeClass("active")}e.recurring_preview(t)}),$(document).on("change",'input[name="frequency_week_days"]',function(){let t=$(this).parents("form"),n=t.find('input[name="repeat_start"]').val();n&&($(`#_week_days_${moment(n).day()}`).prop("checked",!0),e.recurring_preview(t))})})},recurring_preview(e){const t=e.find(".recurring_settings_preview"),n=e.find('input[name="repeat_next"]'),a=myapp.form.collectInputs(e.find(".recurring_options"));axios.get("/sources/events/get-repeat-next-date",{params:a}).then(function(e){let a=e.data.data;if(!a)return t.html('<small>Next repeat</small><strong style="color:#ca0000">Repeating ended</strong>'),void n.val("");t.html(`<small>Next repeat</small><strong>${moment(a,"YYYY-MM-DD").format("(ddd) MMM DD, YYYY")}</strong>`),n.val(a)}).catch(function(e){return e.response.status,console.log([e]),t.html(""),n.val(""),!1})},clearDateFields(e){e&&(e.find('input[name="repeat_start"]').val(""),e.find('input[name="repeat_next"]').val(""),e.find(".recurring_settings_preview").html(""))}},myapp.recurringSetting.init(),"undefined"==typeof myapp&&(myapp={}),myapp.ResidentBooking={init:()=>{const e=myapp.ResidentBooking,t=document.getElementById("bookingCalendar");if(window.slider=e.initBookingSteps(),$("button.booking__go_back").on("click",function(){let e=this.dataset.page||0;slider.slick("slickGoTo",e),this.dataset.enableCartButtons&&myapp.cart.setAddCartButtons("enable")}),!t)return;const n=t.parentNode,a=n.querySelector('input[name="date_start"]'),i=n.querySelector('input[name="date_end"]'),o=n.querySelector('select[name="time_start"]'),r=n.querySelector('select[name="time_end"]'),l=document.getElementById("booking_date"),s=document.getElementById("booking_length"),d=n.querySelector('input[name="booking_length"]'),c=n.querySelector('input[name="booking_length_unit"]'),m=document.querySelector(".payment_date");$('button[name="complete_booking"]').on("click",function(){const t=n.querySelector('select[name="booking_qty"]'),a=t?Number(t.value||1):1;e.updateBookingSummary(l,o,r,s),e.calculatePrice(a,d.value,c.value),slider.slick("slickGoTo",1)}),window.ResidentBooking=flatpickr("#bookingCalendar",{altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",minDate:"today",maxDate:moment().add(3,"months").format("YYYY-MM-DD"),mode:"range",inline:!0,shorthandCurrentMonth:!0,locale:{firstDayOfWeek:1},onChange:function(t,n,r){let s=moment(t[0]),d=s;void 0!==t[1]&&(d=moment(t[1]));const c=s.format("YYYY-MM-DD"),m=d.format("YYYY-MM-DD");if(a.value=c,i.value=m,!l)return e.fixSliderHight(),void $("button[name='continue_order']").attr("disabled",!1);myapp.booking.validateDate({item_path:window.location.href,start:c,end:m,time_start_el:o}),l.innerHTML=e._formatDate(s,d),$("button[name='continue_order']").attr("disabled",!1),$("button[name='complete_booking']").attr("disabled",!1);const p=$("input[name='_available_qty']").val();p&&Number(p)<=0&&$("button[name='complete_booking']").attr("disabled",!0),myapp.booking.fixSliderHight(slider)},onMonthChange:function(t,n,a){const i=a.currentMonth+1+"/1/"+a.currentYear,o=moment(i,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(i,"l").add(6,"weeks").format("YYYY-MM-DD"),e.setCalendar(o,end)},onYearChange:function(t,n,a){const i=a.currentMonth+1+"/1/"+a.currentYear,o=moment(i,"l").add(-1,"weeks").format("YYYY-MM-DD");end=moment(i,"l").add(6,"weeks").format("YYYY-MM-DD"),e.setCalendar(o,end)}}),myapp.booking.timeStartOnChange(o,r),myapp.booking.timeEndOnChange({date_start:a,date_end:i,time_start:o,time_end:r,ui_length:s,in_length:d,in_length_unit:c,ui_payment_date:m,item_url:window.location.href,calculate_price:!1}),e.initPDFPreviewer(),e.initSignatureBox()},initBookingSteps(){const e=$("#BookingForm");if(0!=e.length)return e.slick({infinite:!1,dots:!1,arrows:!1,autoplay:!1,initialSlide:0,speed:450,cssEase:"cubic-bezier(0.86, 0, 0.07, 1)",draggable:!1,swipe:!1,slidesToShow:1,adaptiveHeight:!0}).on("beforeChange",function(t,n,a,i){e.find('[data-slick-index="'+i+'"]').height("auto"),e.find(".slick-list").height("auto"),e.slick("setOption",null,null,!0)}),e},updateBookingSummary(e,t,n,a){const i=document.querySelector(".booking-summary ._date"),o=document.querySelector(".booking-summary ._time"),r=$("#_cleaning_fee");i.innerHTML=e.innerHTML,o.innerHTML=`${$(t).find("option:selected").html()} - ${$(n).find("option:selected").html()} (${a.innerHTML})`;const l=$('input[name="booking_cleaning_fee"]:checked');let s=$(l).val();if(s){s=JSON.parse(s),r.html(`Cleaning fee (${s.name}) <span>$${NumberFormat(s.fee)}</span>`);const e=$("._total");let t=Number(e.data("total")||0);t+=Number(s.fee||0),e.html(`$${NumberFormat(t)}`)}},calculatePrice(e=1,t,n){const a=document.getElementById("booking_hire_costing");if(!a)return;const i=a.querySelector("._qty"),o=a.querySelector("._length"),r=a.querySelector("._subtotal"),l=a.querySelector("._total"),s=a.querySelector('input[name="_qty"]'),d=a.querySelector('input[name="_price"]'),c=a.querySelector('input[name="_price_unit"]'),m=(a.querySelector('input[name="_subtotal"]'),a.querySelector('input[name="_bond"]')),p=c.value;let u=t;if(n!=p)switch(p){case"day":"hour"==n&&(u=(u=t/24)<=.5?.5:round(u,.5));break;case"hour":"day"==n&&(u=24*t)}const g=e*Number(d.value)*u,f=m.value?g+Number(m.value):g;i.innerHTML=e,o.innerHTML=document.getElementById("booking_length").innerHTML,r.innerHTML="$"+NumberFormat(g),l.innerHTML="$"+NumberFormat(f),s.value=e},_formatDate(e,t){let n="D MMM, YYYY",a="D MMM, YYYY";return e.format("YYYY")==t.format("YYYY")&&(n="MMM D",e.format("MMM")==t.format("MMM")&&(a="D, YYYY",e.format("D")==t.format("D")))?e.format("D MMM, YYYY"):`${e.format(n)} - ${t.format(a)}`},fixSliderHight(){window.slider&&(slider.find(".slick-slide:not(.slick-active)").height("0"),slider.find(".slick-slide.slick-active").height("0"),slider.find(".slick-slide.slick-active").height("auto"),slider.find(".slick-list").height("auto"),slider.slick("setOption",null,null,!0))},initPDFPreviewer(){let e=[];const t=document.getElementById("terms-list");if(t)return"undefined"!=t.getAttribute("lg-uid")&&t.getAttribute("lg-uid")&&window.lgData[t.getAttribute("lg-uid")].destroy(!0),lightGallery(t,{selector:".term-link",thumbnail:!1,download:!1,loop:!1,controls:!1,enableDrag:!1,keyPress:!1,closable:!1}),t.addEventListener("onAfterAppendSubHtml",function(n){const a=document.querySelectorAll('input[name="accept_term"]');let i=!0;void 0!==window.lgData.lg1&&(i=n.detail.index==window.lgData.lg1.items.length-1),a.forEach(n=>n.addEventListener("change",function(){if("undefined"!=t.getAttribute("lg-uid")&&t.getAttribute("lg-uid"))if(e.push(this.value),i){{const t=document.querySelector('input[name="accepted_terms"]');t.value=JSON.stringify(e),t.checked=!0,t.dispatchEvent(new Event("change"))}window.lgData[t.getAttribute("lg-uid")].destroy(),e=[]}else window.lgData[t.getAttribute("lg-uid")].goToNextSlide()}))},!1),document.getElementById("open_terms").addEventListener("click",function(){document.querySelector("#terms-list > li:first-child > a").click()}),t},initSignatureBox(){const e=document.getElementById("resident_signature");if(!e)return!1;const t=new SignaturePad(e,{penColor:"rgb(22, 6, 131)",throttle:8,onBegin:()=>{bodyScrollLock.disableBodyScroll(document.querySelector("body"))},onEnd:()=>{bodyScrollLock.enableBodyScroll(document.querySelector("body"))}}),n=document.querySelector(".clearSignature"),a=document.querySelector(".undoSignature");var i;n.addEventListener("click",function(e){t.clear()}),a.addEventListener("click",function(e){var n=t.toData();n&&(n.pop(),t.fromData(n))}),i=Math.max(window.devicePixelRatio||1,1),e.width=e.offsetWidth*i,e.height=e.offsetHeight*i,e.getContext("2d").scale(i,i),t.clear(),window.BookingSignature=t},setCalendar(e,t,n=window.location.href,a=""){(e||t)&&axios.post(n+"/get-dates-in-period",{start:e,end:t,exclude_booking_id:a}).then(function(e){if(!e.data.data)return!1;const t=e.data.data.item,n=e.data.data.dates;let a=ResidentBooking;if(t.type>2){if(4===t.type&&t.service&&3===t.service.is_date){const e=JSON.parse(t.office_hours?t.office_hours:t.building.office_hours);if(!!(!t.service||2!==t.service.is_date)){let n=[];t.NAME_OF_DATE.map((t,a)=>{1==e[t].status&&(n=[...n,6==a?0:a+1])});const i=e=>!n.includes(e.getDay());a.config.disable=[i],a.redraw()}}return!1}const i=t.hire?t.hire.allow_multiple:t.room.allow_multiday,o=t.hire?t.hire.booking_max_length:t.room.booking_max_length;let r=Object.values(n.unavailable),l=r.concat(Object.values(n.disabled_duplicate_book_same_date_by_resident)),s=r.concat(Object.values(n.disabled_for_full_range));const d=e=>null;a.config.mode=1==i?"range":"single",a.config.disable=[...l,d],a.config.dateFormat="Y-m-d",a.config.onDayCreate.push(function(e,t,a,i){let o=i.getAttribute("aria-label");o=moment(i.getAttribute("aria-label"),"MMMM DD, YYYY").format("YYYY-MM-DD"),r.includes(o)?($(i).hasClass("flatpickr-disabled")&&$(i).addClass("full_availability").removeClass("flatpickr-disabled"),i.innerHTML+="<span class='day-status full'></span>"):n.low_availability.includes(o)&&($(i).hasClass("flatpickr-disabled")&&$(i).addClass("low_availability").removeClass("flatpickr-disabled"),i.innerHTML+="<span class='day-status low'></span>")});let c=[];a.config.onChange.push(function(e,t,l,m){if([...n.low_availability,...r].includes(t))return $("#bookingDetailsTab").collapse("hide"),$("button[name='complete_booking']").attr("disabled",!0),sc.alert.show("alert-danger","This day is booked out. Please choose a different day.",5e3),!1;const p=moment(),u=moment(t),g=n.disabled_date_by_office_hours,f=g.includes(String(p.day())),h=g.map(e=>Number(e)).includes(e[0].getDay()),y=moment.duration(u.diff(p)).asHours()<120;if(f&&h&&y)return $("#bookingDetailsTab").collapse("hide"),$("button[name='complete_booking']").attr("disabled",!0),sc.alert.show("alert-danger","Unable to proceed with booking. Please book during office hours.",5e3),!1;if($("#bookingDetailsTab").collapse("show"),"range"===a.config.mode){if(c.length<2){if(0==c.length)if(i&&o){const e=moment(t).add(o+24,"hours").format("YYYY-MM-DD"),n=moment(t).add(-(o+24),"hours").format("YYYY-MM-DD");a.config.disable=[...s,e,n,d]}else a.config.disable=[...s,d];else a.config.disable=[...r,d];c.push(t)}else if(c=[t],!s.includes(t))if(i&&o){const e=moment(t).add(Number(o)+24,"hours").format("YYYY-MM-DD"),n=moment(t).add(24-Number(o),"hours").format("YYYY-MM-DD");a.config.disable=[...s,e,n,d]}else a.config.disable=[...s,d];a.redraw()}}),a.redraw()}).catch(e=>_errorResponse(e))}},myapp.ResidentBooking.init(),"undefined"==typeof myapp&&(myapp={}),myapp.residentInterface={init:()=>{myapp.residentInterface.initTopNavScroll();const e=document.getElementById("booking-card--wrap");e&&(window.StickyBookingCard=new StickySidebar(e,{containerSelector:".booking-single--body",innerWrapperSelector:".card-inner-wrap",topSpacing:90,bottomSpacing:20,resizeSensor:!0,stickyClass:"is-affixed",minWidth:991}))},initTopNavScroll(){const e=document.querySelector(".aria-hero"),t=document.querySelector(".top_navbar._resident");if(!e)return;const n=()=>t.classList.add("scrolled"),a=()=>t.classList.remove("scrolled");document.addEventListener("scroll",function(){window.pageYOffset>=340?n():a()}),window.addEventListener("load",function(){window.pageYOffset>=340?n():a()})}},myapp.residentInterface.init(),"undefined"==typeof myapp&&(myapp={}),myapp.retailDeals={Deals:document.getElementById("retailDeals"),init:function(){this.registerEvents()},registerEvents:function(){let e=this;$(document).on("click","[data-open-deal]",function(){e.open($(this).attr("data-open-deal"))}),e.Deals&&e.Deals.querySelectorAll(".col-deal").forEach(t=>{t.addEventListener("click",function(){e.expand(this)}),t.querySelector('[name="redeem"]').addEventListener("click",function(){e.redeem(this.value)})})},registerCloseEvt:function(e){let t=this;e.querySelector("._close").addEventListener("click",function(t){t.stopPropagation(),e.classList.remove("expanded")},{once:!0}),document.addEventListener("keydown",function(n){"Escape"==(n=n||window.event).key&&e.classList.remove("expanded"),"ArrowRight"==n.key&&t.expand(e.nextElementSibling),"ArrowLeft"==n.key&&t.expand(e.previousElementSibling)},{once:!0})},expand:function(e){this.Deals.querySelectorAll(".col-deal").forEach(e=>{e.classList.remove("expanded")}),e.classList.add("expanded"),setTimeout(function(){e.querySelector(".deal").scrollIntoView({behavior:"smooth",block:"center"})},100),this.registerCloseEvt(e)},open:function(e){if(!e)return;let t=$("#mod-retail-deal");axios.get(`/admin/retail-deal/get/${e}`).then(function(e){if(!e.data)return!1;myapp.modal.fillThenOpen(t,e.data.data)}).catch(e=>_errorResponse(e))},redeem:function(e){let t=this,n=document.querySelector(`.col-deal[data-id="${e}"]`);e&&axios.post("retail-deals/redeem",{deal_id:e}).then(function(e){if(!e.data)return!1;let a=`\n                <div class="success-resp row">\n                    <div class="col align-middle">\n                        <i class="icon-check icon-lg"></i>\n                        <div>\n                            <h3>Congratulations</h3>\n                            <p>${e.data.message}</p>\n                            <p>Here is your redeem code: <strong>${e.data.data.code}</strong></p>\n                        </div>\n                    </div>\n                </div>`,i=n.querySelector(".deal_redeem").innerHTML;n.querySelector(".deal_redeem").innerHTML=a.allTrim(),0===e.data.data.remaining_redeem?n.querySelector("._close").addEventListener("click",function(){n.remove()},{once:!0}):n.querySelector("._close").addEventListener("click",function(){n.querySelector(".deal_redeem").innerHTML=i,n.querySelector('[name="redeem"]').addEventListener("click",function(){t.redeem(this.value)},{once:!0}),e.data.data.label&&(n.querySelector("._counter").innerHTML=e.data.data.label)},{once:!0})}).catch(e=>_errorResponse(e))}},myapp.retailDeals.init(),"undefined"==typeof myapp&&(myapp={}),myapp.select2={init:(e=$(document))=>{let t=myapp.select2;return e.find("[data-s2]").each(function(){t.initSelect2($(this))}),t},initSelect2:e=>{const t=e.attr("data-source")||"",n=e.attr("data-return"),a=(e.attr("data-container-id"),e.attr("data-building-id")||"");if(!e.data("select2"))if(t&&n){const n=["resident","user","admin","building","item"];if(t&&!n.includes(t))return void console.log(`Select2: Data source [${t}] not allowed for field: ${e.attr("name")}.`);let r=`/sources/${t}s`;e.select2({width:"100%",placeholder:e.attr("data-placeholder")||"",templateResult:i,templateSelection:o,ajax:{type:"GET",url:r,data:function(e){return a&&(e.building_id=a),e},dataType:"json",processResults:function(e){return{results:e}}}})}else e.select2({width:"100%",placeholder:"Select",templateResult:i,templateSelection:o});function i(e){switch(t){case"building":return e.id?$(`\n                    <span class="thumb-option">\n                        ${r(e)}\n                        <strong class="name">${e.name}</strong>\n                        <small>${s(e)}</small>\n                    </span>`):e.name;case"item":return e.id?$(`\n                    <span class="thumb-option">\n                        ${l(e)}\n                        <strong class="name">${e.title}</strong>\n                        <small>${e.category_name}</small>\n                    </span>`):e.text;case"user":case"resident":case"admin":return e.id?$(`\n                    <span class="thumb-option">\n                        <strong class="name">${e.name}</strong>\n                        <small>${e.email}</small>\n                    </span>`):e.text}}function o(e){if(e.element&&e.element.dataset.selected){const t=JSON.parse(atob(e.element.dataset.selected));Object.keys(t).forEach(n=>{e[n]=t[n]})}switch(t){case"building":return e.id?$(`\n                    <span class="thumb-selected">\n                        ${r(e)}\n                        <strong class="name">${e.name}</strong>\n                        <small>${s(e)}</small>\n                    </span>`):e.name;case"item":return e.id?$(`\n                    <span class="thumb-selected">\n                        ${l(e)}\n                        <strong class="name">${e.title}</strong>\n                        <small>${e.category_name}</small>\n                    </span>`):e.name;case"user":case"resident":case"admin":return e.id?$(`\n                    <span class="thumb-selected">\n                        <strong class="name">${e.name}</strong>\n                        <small>${e.email}</small>\n                    </span>`):e.name}}function r(e){if(e.is_thumb)return`<span class="initials _bg" style="background-image: url(${e.is_thumb})"></span>`;if(!e.name)return"...";let t=e.name.split(" "),n="";for(var a=0,i=t.length;a<i&&2!=a;a++)n+=t[a][0];return`<span class="initials">${n.toUpperCase()}</span>`}function l(e){return e.is_thumb?`<span class="initials _bg" style="background-image: url(/storage/items/${e.id}/${e.is_thumb}_180x180.jpg)"></span>`:""}function s(e){return`${e.suburb} ${e.postcode}`}}},myapp.select2.init(),"undefined"==typeof myapp&&(myapp={}),myapp.settings={init(){},storeSettings(e){e.prop("disabled",!0).addClass("loading");const t=$("#setting-form");let n=myapp.form.collectInputs(t);$(".html_editor").each(function(e,t){let a=$(t).attr("data-code")||"";a&&(n[a]=this.quill.root.innerHTML)}),axios.post(t.attr("action"),n).then(function(t){if(!t.data.data)return!1;t.data.message&&myapp.alerts.show("alert-success",t.data.message,8e3),e.prop("disabled",!1).removeClass("loading")}).catch(e=>_errorResponse(e))}},myapp.settings.init(),"undefined"==typeof myapp&&(myapp={}),myapp.singlePage={init(){let e=myapp.singlePage;e.initGallery(),e.initPDFList(),e.initPDFPreviewer(),e.publishItem();const t=document.querySelector("#is_signature_required");t&&t.addEventListener("change",function(){SubmitForm($(this).parents("form"))})},initGallery:function(e="._image_gallery ._img"){let t=document.querySelectorAll(e);t&&t.forEach(e=>{e.querySelector("._delete").addEventListener("click",()=>{myapp.singlePage.deleteImage(e,e.dataset.file)})})},initPDFList:function(e="._pdf_list ._pdf"){let t=document.querySelectorAll(e);t&&t.forEach(e=>{e.querySelector("._delete").addEventListener("click",()=>{myapp.singlePage.deletePDF(e,e.dataset.file)}),e.querySelector("._rename").addEventListener("click",()=>{myapp.singlePage.renamePDF(e,e.dataset.file)})})},renamePDF:function(e,t){const n=document.getElementById("mod-rename-file");if(!n)return;let a=getCleanPDFNameFromPath(t);n.querySelector('[name="new_name"]').value=a,n.querySelector('[name="file_path"]').value=t,$(n).modal("show")},deleteImage:function(e,t){if(!t)return!1;axios.post("/files/remove-gallery-image",{thumb_path:t}).then(function(t){if(!t.data)return!1;$(e).hide(250,function(){$(e).remove()}),sc.alert.show("alert-success",t.data.message||"Successful update")}).catch(e=>_errorResponse(e))},deletePDF:function(e,t){if(!t)return!1;axios.post("/files/remove-pdf-attachment",{file_path:t}).then(function(t){if(!t.data)return!1;$(e).hide(250,function(){$(e).remove()}),sc.alert.show("alert-success",t.data.message||"Successful update")}).catch(e=>_errorResponse(e))},moveFile(e,t){if(!e||!t)return!1;axios.post("/files/move",{old_path:e,new_path:t}).then(function(e){if(!e.data)return!1;sc.alert.show("alert-success",e.data.message||"Successful update")}).catch(e=>_errorResponse(e))},initPDFPreviewer(){const e=document.getElementById("terms-list");if(e)return"undefined"!=e.getAttribute("lg-uid")&&e.getAttribute("lg-uid")&&window.lgData[e.getAttribute("lg-uid")].destroy(!0),lightGallery(e,{selector:".term-link",thumbnail:!1,download:!1,loop:!0,controls:!0,enableDrag:!0,keyPress:!0,closable:!0}),e},publishItem(){const e=document.getElementById("publishItem"),t=document.querySelector("#itemTitle .label");e&&e.addEventListener("click",function(){e.classList.add("loading"),axios.post(`/admin/item/publish/${this.dataset.id}`).then(function(n){if(!n.data)return!1;t.classList.remove("l-gray"),t.classList.add("l-green"),t.innerHTML="Active",e.remove(),sc.alert.show("alert-success",n.data.message||"Successful update")}).catch(t=>{e.classList.remove("loading"),_errorResponse(t)})})}},myapp.singlePage.init(),"undefined"==typeof myapp&&(myapp={}),myapp.sortable={init(){const e=document.getElementsByClassName("_image_gallery");Array.prototype.forEach.call(e,e=>{new Sortable(e,{animation:150,onUpdate:function(e){let t=[],n=[];this.el.querySelectorAll("._img").forEach(e=>{t.push(e.dataset.file),n.push(e)}),myapp.sortable.storeGalleryOrder(n,t)}})});const t=document.getElementById("terms-list");t&&new Sortable(t,{animation:150,onUpdate:function(e){let t=[],n=[];this.el.querySelectorAll("._pdf").forEach(e=>{t.push(e.dataset.file),n.push(e)}),myapp.sortable.storePDFOrder(n,t)}});const n=document.getElementById("categoryList");n&&new Sortable(n,{handle:".drag-handle",animation:150,onUpdate:function(e){let t=[];this.el.querySelectorAll("tr").forEach(e=>{t.push(e.dataset.id)}),myapp.sortable.storeCategoryOrder(t)}})},storeGalleryOrder(e,t){axios.post("/files/order-gallery-images",{order:t}).then(function(t){if(!t.data.data)return!1;e.forEach(e=>{e.dataset.file=t.data.data[e.dataset.file]}),sc.alert.show("alert-success","Order updated")}).catch(e=>_errorResponse(e))},storePDFOrder(e,t){axios.post("/files/order-pdf-terms",{order:t}).then(function(t){if(!t.data.data)return!1;e.forEach(e=>{let n=t.data.data[e.dataset.file];e.dataset.file=n,e.querySelector(".term-link").href="/storage/"+n}),sc.alert.show("alert-success","Order updated")}).catch(e=>_errorResponse(e))},storeCategoryOrder(e){axios.post("/admin/settings/category/store-order",{order:e}).then(function(e){sc.alert.show("alert-success",e.data.message)}).catch(e=>_errorResponse(e))}},myapp.sortable.init(),void 0===myapp.templates&&(myapp.templates={}),myapp.templates.booking={renderBooking(e,t,n){if(!t)return;let a=!1;switch(t.type){case 1:case 2:case 3:a=1==t.status;break;case 4:a=!(!t.bookable_item.service.is_date||1!=t.status)}let i=`\n        <div class="manage__booking">\n\n            <button type="button" class="_close"><i class="material-icons">close</i></button>\n            \n            <div class="head">\n                ${t.thumb?`<img src="${t.thumb}" alt="${t.bookable_item.title}"/>`:""}\n                <h5>${t.number}</h5>\n                <h3>${t.bookable_item.title}</h3>\n                <span>${t.bookable_item.category.name}</span>\n            </div>\n\n            <div class="body">\n                <form method="POST" id="updateBooking" action="/booking/${t.id}" data-reload="true">\n                \n                    <div class="booking-detail">\n                        <div class="row">\n                            <div class="col-sm-6 _detail">\n                                <small>Booking for</small>\n                                <span>\n                                    ${t.user.first_name} ${t.user.last_name} ${t.user.is_flagged?t.user.flagged_label:""} <small>(${t.user.role.display_name})</small>\n                                </span>\n                            </div>\n                            <div class="col-sm-2 _detail">\n                                <small>Unit No.</small>\n                                <span>${t.user.unit_no||""}</span>\n                            </div>\n                            <div class="col-sm-4 _detail">\n                                <small>Booked on</small>\n                                <span>${moment(t.created_at).format("DD MMM, YYYY")} <i class="icon-info" data-tippy-content="Last edited: ${moment(t.updated_at).format("DD MMM, YYYY")}"></i></span>\n                            </div>\n                        </div>\n\n                        ${[1,2].includes(t.type)||4==t.type&&t.start?`\n                        <div id="bookingDetailsTab">\n                            <input type="hidden" name="date_start"/>\n                            <input type="hidden" name="date_end"/>\n                            <div class="row">\n                                <div class="col-12 mb-2">\n                                    <small class="d-block">${t.bookable_item.service&&t.bookable_item.service.date_field_name?t.bookable_item.service.date_field_name:"Booking dates"}</small>\n                                    <div id="bookingCalendar" class="edit-booking ${a?"":"disabled"}">\n                                        <span id="booking_date">${t.date_formatted}</span>\n                                        <i class="material-icons">keyboard_arrow_down</i>\n                                    </div>\n                                </div>\n                                ${4!=t.type?`\n                                <div class="col-sm-4 col-xs-6">\n                                    <small>${2==t.type?"Pickup":"From"}</small>\n                                    <select class="form-control ${a?"":"disabled"}" id="booking_from" name="time_start" tabindex="0">${t.start_time_option}</select>\n                                </div>\n                                <div class="col-sm-4 col-xs-6">\n                                    <small>${2==t.type?"Drop-off":"To"}</small>\n                                    <select class="form-control ${a?"":"disabled"}" id="booking_to" name="time_end" tabindex="0">${t.end_time_option}</select>\n                                </div>\n                                <div class="col-sm-4 col-xs-12">\n                                    <small>Length</small>\n                                    <span id="booking_length" class="booking_length mt-2"></span>\n                                    <input type="hidden" name="booking_length" tabindex="0" value="">\n                                    <input type="hidden" name="booking_length_unit" tabindex="0" value="">\n                                </div>\n                                `:""}\n                            </div>\n                        </div>\n                        `:`\n                        ${3==t.type?`\n                            <div class="row">\n                                <div class="col-6">\n                                    <small class="d-block">Event date & time</small>\n                                    ${1==t.bookable_item.event.event_type?`\n                                        <span class="_date">${moment(t.bookable_item.event.event_date).format("DD MMM, YYYY")}</span>\n                                    `:`\n                                        <span class="_date">${moment(t.bookable_item.recurring.repeat_next).format("DD MMM, YYYY")}</span>\n                                    `}\n                                    <span class="_time">${moment(t.bookable_item.event.event_date+" "+t.bookable_item.event.event_from).format("hh:mm a")}</span>\n                                </div>\n                                <div class="col-6">\n                                    <small class="d-block">Location</small>\n                                    ${t.bookable_item.event.location?`\n                                    <span class="_location">${t.bookable_item.event.location.title}</span>\n                                    `:`\n                                    <span class="_location">${t.bookable_item.event.location_name}</span>\n                                    `}\n                                </div>\n                            </div>`:""}\n                        `}`;if(i+=`\n                        <div class="row">\n                            ${1==t.type&&t.user.is_admin?`\n                                    <div class="col-12 mt-4">\n                                        <div class="checkbox text-left mb-0">\n                                            <input type="checkbox" id="cleaning_required" name="cleaning_required" class="" value="1" data-parsley-multiple="cleaning_required" ${0===t.cleaning_required?"":"checked"}>\n                                            <label for="cleaning_required">Cleaning required</label>\n                                        </div>\n                                    </div>\n                                `:""}\n                            ${1==t.type&&!t.user.is_admin&&t.other_fee&&t.other_fee.length>0?`\n                                    <div class="col-12 mt-4">\n                                        <small class="text-muted">Cleaning Fee</small>\n                                        ${t.other_fee.map(e=>`<p>${e.name} - $${e.fee}</p>`)}\n                                    </div>\n                                `:""}\n                            <div class="col-12 mt-4">\n                                <small class="text-muted">Resident Comments</small>\n                                ${1===t.status?`<textarea class="form-control" name="booking_comments" rows="3" style="height: auto !important">${t.booking_comments||""}</textarea>`:`<p>${t.booking_comments}</p>`}\n                            </div>\n                        </div>\n                    </div>\n                    ${window.isAdmin?`\n                            <div class="mt-3 booking-card-footer">\n                                ${1==t.status?`<button type="button" class="btn btn-sm btn-cancel" data-tippy-allowHTML="true" data-tippy-interactive="true" data-tippy-trigger="click" data-tippy-content="Are you cancelling this booking? <button type='button' data-cancel-booking='${t.id}' class='btn confirm_cancel_btn'>Yes, Cancel</button>">Cancel booking</button>`:""}\n                                ${a?'<button type="submit" name="store" class="btn btn-sm btn-primary float-right">Save changes</button>':""}\n                                ${n?"":`<a href="/admin/booking/${t.id}" class="btn btn-sm btn-brand btn-arrow float-right">Booking <i class="material-icons">arrow_forward</i></a>`}\n                            </div>\n                        `:""}\n\n                </form>\n            </div>\n        </div>`,!e)return i;e.querySelector(".modal-body").innerHTML=i},renderResidentBooking(e,t,n){if(!t)return;let a=!1;switch(t.type){case 1:case 2:a=1==t.status;break;case 3:a=!1;break;case 4:a=!(!t.bookable_item.service.is_date||1!=t.status)}let i=`\n        <div class="manage__booking">\n            \n            ${n?myapp.templates.booking.successResponse():""}\n            <div class="head">\n                ${t.thumb?`<img src="${t.thumb}" alt="${t.bookable_item.title}"/>`:""}\n                <h5>${t.number}</h5>\n                <h3>${t.bookable_item.title}</h3>\n                <span>${t.type_label}</span>\n            </div>\n\n            <div class="body">\n                <form method="POST" id="updateBooking" action="/booking/${t.id}">\n                    <div class="booking-detail">\n                        ${[1,2].includes(t.type)||4==t.type&&t.start?`\n                        <div id="bookingDetailsTab">\n                            <input type="hidden" name="date_start"/>\n                            <input type="hidden" name="date_end"/>\n                            <div class="row">\n                                <div class="col-12 mb-2">\n                                    <small class="d-block">${t.bookable_item.service&&t.bookable_item.service.date_field_name?t.bookable_item.service.date_field_name:"Booking dates"}</small>\n                                    <div id="bookingCalendar" class="edit-booking ${a?"":"disabled"}">\n                                        <span id="booking_date">${t.date_formatted}</span>\n                                        <i class="material-icons">keyboard_arrow_down</i>\n                                    </div>\n                                </div>\n                                ${4!=t.type?`\n                                <div class="col-sm-4 col-xs-6">\n                                    <small>${2==t.type?"Pickup":"From"}</small>\n                                    <select class="form-control ${a?"":"disabled"}" id="booking_from" name="time_start" tabindex="0">${t.start_time_option}</select>\n                                </div>\n                                <div class="col-sm-4 col-xs-6">\n                                    <small>${2==t.type?"Drop-off":"To"}</small>\n                                    <select class="form-control ${a?"":"disabled"}" id="booking_to" name="time_end" tabindex="0">${t.end_time_option}</select>\n                                </div>\n                                <div class="col-sm-4 col-xs-12">\n                                    <small>Length</small>\n                                    <span id="booking_length" class="booking_length mt-2"></span>\n                                    <input type="hidden" name="booking_length" tabindex="0" value="">\n                                    <input type="hidden" name="booking_length_unit" tabindex="0" value="">\n                                </div>\n                                `:""}\n                            </div>\n                        </div>\n                        `:`\n                        ${3==t.type?`\n                            <div class="row">\n                                <div class="col-6">\n                                    <small class="d-block">Event date & time</small>\n                                    ${1==t.bookable_item.event.event_type?`\n                                        <span class="_date">${moment(t.bookable_item.event.event_date).format("DD MMM, YYYY")}</span>\n                                    `:`\n                                        <span class="_date">${moment(t.bookable_item.recurring.repeat_next).format("DD MMM, YYYY")}</span>\n                                    `}\n                                    ${1==t.bookable_item.event.event_type&&t.bookable_item.event.event_from?`<small>@</small> <span class="_time">${moment(t.bookable_item.event.event_date+" "+t.bookable_item.event.event_from).format("hh:mm a")}</span>`:""}\n                                </div>\n                                <div class="col-6">\n                                    <small class="d-block">Location</small>\n                                    ${t.bookable_item.event.location?`\n                                    <span class="_location">${t.bookable_item.event.location.title}</span>\n                                    `:`\n                                    <span class="_location">${t.bookable_item.event.location_name}</span>\n                                    `}\n                                </div>\n                            </div>`:""}\n                        `}`;switch(t.type){case 1:t.total&&t.total>0&&(i+=`\n                                    <div id="bookingSum" class="booking-sum">\n                                        <ul>\n                                            <li>Admin fee <span>$${NumberFormat(t.bookable_item.admin_fee)}</span></li> \n                                            ${t.other_fee&&t.other_fee.length>0?t.other_fee.map(e=>`<li>Cleaning fee (${e.name}) <span>$${NumberFormat(e.fee)}</span></li> `):""}\n                                        </ul>\n                                        <h4>Your total: <span class="_total">$${NumberFormat(t.total)}</span></h4>\n                                    </div>\n                                    <div class="payment_notes">\n                                        <span>Your payment will be charged on <b class="payment_date">${moment(t.cancellation_cutoff_date).format("DD MMM, YYYY")}</b></span><br>\n                                        <small>${t.payment_note_sub}</small>\n                                    </div>\n                                    ${t.user.card?`${myapp.templates.booking.creditCard(t.user.card)}`:""}\n                                    `);break;case 2:let e=JSON.parse(t.line_items);t.total&&t.total>0&&(i+=`\n                                    <div id="bookingSum" class="booking-sum">\n                                        <input type="hidden" name="_qty" value="${t.qty}"/>\n                                        <input type="hidden" name="_price" value="${e.price}"/>\n                                        <input type="hidden" name="_price_unit" value="${e.price_unit}"/>\n                                        <input type="hidden" name="_subtotal" value="${t.subtotal}"/>\n                                        <input type="hidden" name="_bond" value="${t.bond}"/>\n                                        <ul>\n                                            <li><strong class="_qty">${t.qty}</strong> x <b>${t.bookable_item.title}</b> <span>$${NumberFormat(e.price)}<small>/${e.price_unit}</small></span></li>\n                                            <li>Your booking total (inc. GST) <span class="_subtotal">$${NumberFormat(t.subtotal)}</span></li>\n                                        ${t.bond&&t.bond>0?`\n                                            <li>Security deposit <span><i class="icon-info" data-tippy-content="${t.deposit_info}"></i> $${NumberFormat(t.bond)}</span></li>\n                                        `:""}\n                                        </ul>\n                                        <h4>Charge amount: <span class="_total">$${NumberFormat(parseInt(t.total)+parseInt(t.bond))}</span></h4>\n                                    </div>\n                                    <div class="payment_notes">\n                                        <span>Your payment will be charged on <b class="payment_date">${moment(t.cancellation_cutoff_date).format("DD MMM, YYYY")}</b></span><br>\n                                        <small>${t.payment_note_sub}</small>\n                                    </div>\n                                    ${t.user.card?`${myapp.templates.booking.creditCard(t.user.card)}`:""}\n                                    `);break;case 3:t.total&&t.total>0&&(i+=`\n                                    <div id="bookingSum" class="booking-sum">\n                                        <ul>\n                                            <li>${t.event.attendees_num} attendee(s) x <span>Admin fee $${NumberFormat(t.bookable_item.admin_fee)}</span></li> \n                                        </ul>\n                                        <h4>Your total: <span class="_total">$${NumberFormat(t.total)}</span></h4>\n                                    </div>\n                                    <div class="payment_notes">\n                                        <span>Your payment will be charged on <b class="payment_date">${moment(t.cancellation_cutoff_date).format("DD MMM, YYYY")}</b></span><br>\n                                        <small>${t.payment_note_sub}</small>\n                                    </div>\n                                    ${t.user.card?`${myapp.templates.booking.creditCard(t.user.card)}`:""}\n                                    `);break;case 4:i+=`\n                                <div id="bookingSum" class="booking-sum">\n                                    <h5 class="services-title">Ordered items</h5>\n                                    <ul>\n                                        ${Object.values(t.line_items).map(e=>`<li><strong class="_qty">${e.qty}</strong> x <b>${e.name}</b> <span>$${NumberFormat(e.price)}</span></li>`).join("")}\n                                        <li>Subtotal (inc. GST) <span class="_subtotal">$${NumberFormat(t.subtotal)}</span></li>\n                                        ${t.admin_fee?`\n                                        <li>Admin fee <span>$${NumberFormat(t.admin_fee)}</span></li>\n                                        `:""}\n                                        ${t.bond?`\n                                        <li>Security deposit <span>$${NumberFormat(t.bond)}</span></li>\n                                        `:""}\n                                    </ul>\n                                    <h4>Your total: <span class="_total">$${NumberFormat(t.total)}</span></h4>\n                                </div>`}!a&&t.transactions&&(i+=myapp.templates.booking.transactions(t)),i+=`\n                    </div>\n                    ${a&&!n?'<button type="submit" name="store" class="btn btn-primary float-right">Save changes</button>':""}\n                </form>\n                ${1!=t.status||n?"":`<button type="button" class="btn btn-small btn-cancel" data-tippy-allowHTML="true" data-tippy-interactive="true" data-tippy-trigger="click" data-tippy-content="Are you cancelling this booking? <button type='button' data-cancel-booking='${t.id}' class='btn confirm_cancel_btn'>Yes, Cancel</button>">Cancel booking</button>`}\n            </div>\n        </div>`,e.querySelector(".modal-body").innerHTML=i},creditCard:e=>template=`\n            <div id="credit-card" class="credit-card">\n                <div class="credit-card--row">\n                    <img src="/img/${e.type_slug}-logo.jpg" alt="${e.type}"/>\n                    <h3>${e.type} **** **** **** <strong>${e.end}</strong></h3>\n                    <span class="card-exp">Expiry ${e.exp_month}/${e.exp_year} <span class="badge${e.exp_soon_class}">${e.expiry_in_str}</span></span>\n                    <a href="/profile" class="btn btn-b btn-sm" data-tippy-content="Attached Credit Card can be changed in your profile settings. Click to proceed.">\n                        Change Card\n                    </a>\n                </div>\n            </div>`,transactions(e){if(!e.transactions.length)return"";return`\n        <h4>Payments</h4>\n        <div class="transactions">\n            ${e.transactions.map(e=>`\n                <div class="_transaction">\n                    <div class="row">\n                        <div class="col-sm-3">\n                            <small class="d-block">Transaction id</small> \n                            <span class="_id">${e.transactionID}</span>\n                        </div>\n                        <div class="col-sm-3">\n                            <small class="d-block">Status</small> \n                            <span class="_status">${e.responseMessage}</span>\n                        </div>\n                        <div class="col-sm-3">\n                            <small class="d-block">Amount</small> \n                            <span class="_amount">$${NumberFormat(e.totalAmount)}</span>\n                        </div>\n                        <div class="col-sm-3">\n                            <small class="d-block">Date</small> \n                            <span class="_amount">${moment(e.created_at).format("DD MMM, YYYY")}</span>\n                        </div>\n                        <div class="col-sm-12">\n                            <a href="#" class="d-block inline-link mt-2" data-get-pdf-receipt="${e.id}"><i class="material-icons">file_download</i> Payment Receipt</a>\n                        </div>\n                    </div>\n                </div>`).join("")}\n        </div>`},successResponse(e){let t="Thank you for your Booking";return 4==e&&(t="Thank you for your Order"),`\n        <div class="booking-success">\n            <i class="_icon icon-check"></i>\n            <h3>${t}</h3>\n        </div>`}},void 0===myapp.templates&&(myapp.templates={}),myapp.templates.comment={render(e,t=!0){if(!(e=Object.entries(e)).length)return"";let n="",a="";for(const[i,o]of e)t&&o.created_date!=n&&(a+=`\n                    <div class="comment-feed-date${"Today"==o.created_day?" today":""}">\n                        <div class="w-bg">\n                            <span class="day">${o.created_day}</span> \n                            ${o.created_date}\n                        </div>\n                    </div>`),a+=`\n            <div class="comment" data-id="${o.id}">\n                <div class="comment--head">\n                    <span class="--user">${o.user?o.user.name:"troubl.io"}</span>\n                    <span class="--at">${o.created_time}</span>\n                    ${o.activity?`<span class="--hours">${o.activity.hours_formatted}h <span>${o.activity.date_formatted}</span></span>`:""}\n                    ${o.remind_at?`<span class="--reminder">${o.remind_at_formatted}</span>`:""}\n                    <div class="--actions">\n                        ${myapp.templates.comment.actionButtons(o)}\n                        <button type="button" class="reply" name="reply" data-tippy-content="Reply"><i class="material-icons">reply</i></button>\n                    </div>\n                </div>\n                <div class="comment--body">${o.comment_html}</div>\n                ${o.replies?myapp.templates.comment.reply(o.replies):""}\n            </div>`,n=o.created_date;return a.allTrim()},reply(e){let t="";return e.forEach(function(e){t+=`\n            <div class="comment--reply" data-id="${e.id}">\n                <div class="comment--head">\n                    <span class="--user">${e.user?e.user.name:"troubl.io"}</span>\n                    <span class="--at">${e.created_date}, ${e.created_time}</span>\n                    <div class="--actions">\n                        ${myapp.templates.comment.actionButtons(e)}\n                    </div>\n                </div>\n                <div class="comment--body">${e.comment_html}</div>\n            </div>`}),t.allTrim()},renderEditor:(e,t="")=>`\n            <div class="${e?"edit":"new"}">\n                <input type="hidden" name="id" value="${e?e.id:""}"/>\n                ${2==e.type?'<input type="hidden" name="reply_comment_id" value=""/>':""}\n                <div class="mde-editor">\n                    <textarea class="comment" rows="1" name="comment" placeholder="Add a comment, hours or task">${e?e.comment:""}</textarea>\n                    <button type="button" name="${e?"edit":"add"}" class="btn btn-primary btn-sm pull-right">${e?"Save":"Post"}</button>\n                </div>\n            </div>`.allTrim(),renderReplyEditor:(e,t)=>`\n            <div class="edit reply">\n                <input type="hidden" name="id" value="${e}"/>\n                <input type="hidden" name="parent_comment_id" value="${t}"/>\n                <input type="hidden" name="notify" value="${e>0?1:3}"/>\n                <div class="mde-editor">\n                    <textarea class="comment" rows="1" name="comment" placeholder="Add a comment"></textarea>\n                    <button type="button" name="edit" class="btn btn-primary btn-sm pull-right">Post</button>\n                </div>\n            </div>`.allTrim(),actionButtons(e){if(!e.can_edit)return"";return`<div class="btn-group">\n                <button type="button" class="trigger" data-toggle="dropdown" aria-expanded="true">\n                    <i class="material-icons">more_horiz</i>\n                </button>\n                <ul role="menu" class="dropdown-menu dropdown-menu-right">\n                    <li><button type="button" name="edit" value="${e.id}">Edit</button></li>\n                    <li><button type="button" name="delete" value="${e.id}">Delete</button></li>\n                </ul>\n            </div>`.allTrim()}},"undefined"==typeof myapp&&(myapp={}),myapp.tippy={init(e=null){if("undefined"==typeof tippy)return;const t=e?e.querySelectorAll("[data-tippy-content]"):document.querySelectorAll("[data-tippy-content]"),n=Array.from(t).filter(e=>void 0===e._tippy);tippy(n,{appendTo:"parent",hideOnClick:!0,trigger:"mouseenter",theme:"translucent",animation:"shift-toward-subtle"})},initFiles(){"undefined"!=typeof tippy&&(tippy(".tippy-confirm-delete",{allowHTML:!0,interactive:!0,appendTo:"parent",delay:[0,500],trigger:"click",theme:"light",placement:"left-end",animation:"shift-toward-subtle"}),tippy(".file-name",{appendTo:()=>this.parentNode.parentNode,hideOnClick:!0,trigger:"mouseenter",theme:"light",animation:"shift-toward-subtle",delay:400}))}},myapp.tippy.init();
